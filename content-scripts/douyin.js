var douyin=function(){"use strict";var wo=Object.defineProperty;var bo=(le,te,F)=>te in le?wo(le,te,{enumerable:!0,configurable:!0,writable:!0,value:F}):le[te]=F;var R=(le,te,F)=>bo(le,typeof te!="symbol"?te+"":te,F);var mt,ht;function le(t){return t}const F=(ht=(mt=globalThis.browser)==null?void 0:mt.runtime)!=null&&ht.id?globalThis.browser:globalThis.chrome,Se={"sycm.taobao":{name:"生意参谋",domain:"sycm.taobao",fullDomain:"sycm.taobao.com"},"one.alimama":{name:"阿里妈妈万象台",domain:"one.alimama",fullDomain:"one.alimama.com"},taobao:{name:"淘宝",domain:"taobao",fullDomain:"taobao.com"},tmall:{name:"天猫",domain:"tmall",fullDomain:"tmall.com"},tmallhk:{name:"天猫国际",domain:"tmallhk",fullDomain:"tmall.hk"},douyin:{name:"抖音",domain:"douyin",fullDomain:"douyin.com"},xiaohongshu:{name:"小红书",domain:"xiaohongshu",fullDomain:"xiaohongshu.com"},jd:{name:"京东",domain:"jd",fullDomain:"jd.com"},tiktok:{name:"tiktok",domain:"tiktok",fullDomain:"tiktok.com"},youtube:{name:"youtube",domain:"youtube",fullDomain:"youtube.com"},other:{name:"其他",domain:"other",fullDomain:"other"}};function bt(t){console.log("getDomain",t),t||(t=window.location.href);for(let e in Se)if(t.includes(Se[e].fullDomain))return Se[e].domain;return Se.other.domain}function St(t,e="data_"){return t&&t.indexOf("https://sycm.taobao.com/cc/customer/trip")===0?t="https://sycm.taobao.com/cc/customer/trip":t&&t.indexOf("https://sycm.taobao.com/cc/customer/overview")===0?t="https://sycm.taobao.com/cc/customer/overview":t&&t.indexOf("https://one.alimama.com/index.html#!/manage/onesite")===0&&(t="https://one.alimama.com/index.html#!/manage/onesite"),e+btoa(t)}function Ve(t,e=5e3){return new Promise((o,s)=>{console.log(`等待元素加载: ${t}, 超时: ${e}ms`);const n=document.querySelector(t);if(n)return o(n);const i=setTimeout(()=>{if(r){r.disconnect(),console.log(`等待元素超时: ${t}`);const l=document.querySelector(t);l?o(l):s(new Error(`等待元素超时: ${t}`))}},e),r=new MutationObserver((l,c)=>{const d=document.querySelector(t);d&&(clearTimeout(i),c.disconnect(),o(d))});r.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","data-e2e"]}),console.log("MutationObserver已启动")})}class xt{constructor(){R(this,"sleep",e=>new Promise(o=>setTimeout(o,e)));R(this,"runDelay",async(e,o)=>new Promise(s=>setTimeout(()=>{s(e())},o)));R(this,"sendMessage",e=>{F.runtime.sendMessage({action:"updateStatus",status:e})});R(this,"sendDataWithAction",(e,o)=>{F.runtime.sendMessage({action:o,data:e})});R(this,"openPopup",(e=-1)=>{F.runtime.sendMessage({action:"openPopup",windowId:e})});R(this,"openSidePanel",(e=-1)=>{F.runtime.sendMessage({action:"openSidePanel",windowId:e})});R(this,"elementHover",(e,o=!0)=>{e.dispatchEvent(new MouseEvent(o?"mouseover":"mouseout",{bubbles:!0}))});R(this,"setElementAnimation",e=>{const o="266A247A-6C68-4F89-8D11-B767B4E7A71C",s="animation_"+o.slice(0,8),n="class_"+o.slice(0,8);if(!document.head.querySelector(`style[data-id='${o}']`)){const i=document.createElement("style");i.type="text/css",i.setAttribute("data-id",o);const r=`
      @keyframes ${s}{
        to {  background-color :rgb(255, 0, 0);
              border: 1px solid blue;
              border-radius: 3px;
        }
      }
    `,l=`
      .${n} {
        animation: ${s} 0.5s ease-in-out 0s 2 alternate none;
      }
    `;i.innerHTML=r+l,document.head.appendChild(i)}return e.classList.remove(n),e.offsetHeight,e.classList.add(n),e});R(this,"waitForChildListChange",async(e,o,s=5e3)=>new Promise((n,i)=>{const r=setTimeout(()=>{l&&(l.disconnect(),console.log("等待元素更新超时: ",o,`超时时间：${s}ms`),n(!1))},s),l=new MutationObserver((c,d)=>{if(c.length>0)for(const a of c)if(a.type==="attributes")a.attributeName;else if(a.type==="childList"){clearTimeout(r),d.disconnect(),n(!0);return}else a.type});l.observe(o,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0}),e&&e()}));R(this,"waitForElementTextChange",async(e,o,s=5e3)=>new Promise((n,i)=>{console.log("等待元素更新:",o,` 超时: ${s}ms`);const r=setTimeout(()=>{l&&(l.disconnect(),console.log("等待元素更新超时: ",o,`超时时间：${s}ms`),n(!1))},s),l=new MutationObserver((c,d)=>{if(c.length>0){for(const a of c)if(a.type==="attributes")a.attributeName;else if(a.type!=="childList"){if(a.type==="characterData"){clearTimeout(r),d.disconnect(),n(!0);return}}}});l.observe(o,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0}),e&&e()}));R(this,"waitForElementAttrChange",async(e,o,s=5e3)=>new Promise((n,i)=>{console.log("等待元素属性更新:",o,` 超时: ${s}ms`);const r=setTimeout(()=>{l&&(l.disconnect(),console.log("等待元素属性更新超时: ",o,`超时时间：${s}ms`),n(!1))},s),l=new MutationObserver((c,d)=>{if(c.length>0)for(const a of c)if(a.type==="attributes"){a.attributeName,clearTimeout(r),d.disconnect(),n(!0);return}else a.type==="childList"||a.type});l.observe(o,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0}),e&&e()}));R(this,"waitForElementListTextChange",async(e,o,s=5e3,n=!0)=>{let i=[];return new Promise((r,l)=>{o.forEach(c=>{this.waitForElementTextChange(()=>{},c,s).then(async d=>{i.push({target:c,result:d}),n?i.length===o.length&&r(i):i.length==1&&(await this.sleep(500),r(i))})}),e&&e()})});R(this,"waitForElementListAttrChange",async(e,o,s=5e3,n=!0)=>{let i=[];return new Promise((r,l)=>{o.forEach(c=>{this.waitForElementAttrChange(()=>{},c,s).then(async d=>{i.push({target:c,result:d}),n?i.length===o.length&&r(i):i.length==1&&(await this.sleep(500),r(i))})}),e&&e()})});R(this,"waitForElementRemove",async(e,o=5e3)=>new Promise((s,n)=>{const r=o/10;let l=0;const c=setInterval(()=>{if(!document.querySelector(e)){clearInterval(c),s(!0);return}l++,l<r?console.log("等待元素移除:",e,` 超时: ${o}ms`,`剩余时间：${o-l*10}ms`):(console.log("等待元素移除超时: ",e,`超时时间：${o}ms`),clearInterval(c),n(!1))},10)}));R(this,"scrollToElementTop",e=>{e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})});R(this,"scrollToElement",e=>{e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})});R(this,"scrollToElementBottom",e=>{e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})});R(this,"ensureElementVisible",e=>{let o=e;for(;o&&o!==document.body;){const l=o.parentElement;if(!l)break;const c=l.scrollHeight>l.clientHeight,d=l.scrollWidth>l.clientWidth;if(c||d){const a=l.getBoundingClientRect(),m=o.getBoundingClientRect();c&&(m.top<a.top?l.scrollTop-=a.top-m.top:m.bottom>a.bottom&&(l.scrollTop+=m.bottom-a.bottom)),d&&(m.left<a.left?l.scrollLeft-=a.left-m.left:m.right>a.right&&(l.scrollLeft+=m.right-a.right))}o=l}const s=window.scrollY,n=s+window.innerHeight,i=e.offsetTop,r=i+e.offsetHeight;i<s?window.scrollTo({top:i,behavior:"smooth"}):r>n&&window.scrollTo({top:r-window.innerHeight,behavior:"smooth"})});R(this,"getTextNodeValue",(e,o=!1)=>{this.setElementAnimation(e);const s=Array.from(e.childNodes).filter(n=>n.nodeType===Node.TEXT_NODE).map(n=>n.textContent).join("");return o?+s.replace(/[^\d-.]/g,""):s});R(this,"getElementText",(e,o=!0)=>e?(o&&this.setElementAnimation(e),e.textContent):"");R(this,"getElementTextToNumber",(e,o=!0)=>{if(e){const s=this.getElementText(e,o).replace(/[^\d-.]/g,"");return s&&!isNaN(s)?+s:s}return 0});R(this,"getUserInputNumber",async(e=10,o="请输入最大数据条数，默认10条，最小1条，最大100条",s=100)=>{let n=await this.showInput(o,e,s);for(;n;){let i=0;if(!isNaN(n)&&(i=parseInt(n),i>0&&i<=s)){e=i;break}n=await this.showInput(o,e,s)}return e});R(this,"waitElementInViewportUseObserver",async(e,o=5e3)=>new Promise((s,n)=>{this.isElementInViewport(e)&&s(!0),setTimeout(()=>{s(!1),i.disconnect()},o);const i=new IntersectionObserver(r=>{r.forEach(async l=>{l.isIntersecting&&(s(!0),i.disconnect())})});if(!e)return n("元素不存在");this.scrollToElement(e),i.observe(e)}));R(this,"waitElementInViewportUseClientRect",async(e,o=!1,s=5e3)=>{new Promise(async(n,i)=>{if(!e||typeof e.getBoundingClientRect!="function")return n(!1);let r=null;const l=()=>{const m=e.getBoundingClientRect(),w=window.innerHeight||document.documentElement.clientHeight,p=window.innerWidth||document.documentElement.clientWidth;let $=!1;if(o)$=m.top>=0&&m.bottom<=w&&m.left>=0&&m.right<=p;else{const A=m.top<=w&&m.bottom>=0,v=m.left<=p&&m.right>=0;$=A&&v}$&&(r&&clearInterval(r),n(!0))},c=10,d=parseInt(s/c+"")>0?parseInt(s/c+""):1;let a=0;r=setInterval(()=>{a++,a>d?(r&&clearInterval(r),n(!1)):l()},c)})});R(this,"isElementInViewport",e=>{const o=e.getBoundingClientRect(),s=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth;return o.top<s&&o.bottom>0&&o.left<n&&o.right>0});R(this,"getItemTextAndLog",(e,o,s,n="")=>{const i=this.querySelector(e,o);let r=this.getElementText(i);return n&&(r=(i==null?void 0:i.getAttribute(n))||""),s&&!i&&console.log(s),r});R(this,"waitForResult",async(e,o=5e3)=>{const s=Math.floor(o/100);for(let n=0;n<s;n++){if(await e())return!0;await this.sleep(100)}return!1});R(this,"getNumberText",e=>{const o=e.match(/[\.\d]+(千万)?(万亿)?[万|亿|k|K|m|M|b|B]?/);return o?o[0]:e})}deepScroll(e){return new Promise((o,s)=>{const n=[],i={element:e.element||window,duration:e.duration||500,easing:e.easing||"easeInOutQuad",scrollContainers:n,left:e.left,top:e.top,target:e.target,callback:e.callback};function r(h){const L=[];let _=h;for(;_&&_!==document.documentElement;)l(_)&&L.push(_),_=_.parentElement;return c()&&L.push(window),L}function l(h){if(h===window||!(h instanceof HTMLElement))return!0;const L=getComputedStyle(h),_=L.overflowY==="auto"||L.overflowY==="scroll",T=L.overflowX==="auto"||L.overflowX==="scroll";return _&&h.scrollHeight>h.clientHeight||T&&h.scrollWidth>h.clientWidth}function c(){return document.documentElement.scrollHeight>window.innerHeight}function d(h,L){const _=L.getBoundingClientRect();if(h instanceof Window)return{top:a(_.top-window.pageYOffset+window.outerHeight,_.height,window.innerHeight,window.outerHeight),left:a(_.left-window.pageXOffset+window.outerWidth,_.width,window.innerWidth,window.outerWidth)};const T=h.getBoundingClientRect();return{top:a(_.top-T.top+h.scrollTop,_.height,h.clientHeight,h.scrollTop),left:a(_.left-T.left+h.scrollLeft,_.width,h.clientWidth,h.scrollLeft)}}function a(h,L,_,T){const S=T,E=T+_,q=h+L;return h>=S&&q<=E?T:h<S?h:q-_}function m(h){return h instanceof Window?window.pageYOffset:h.scrollTop}function w(h){return h instanceof Window?window.pageXOffset:h.scrollLeft}function p(h,L,_){h instanceof Window?window.scrollTo(_,L):(h.scrollTop=L,h.scrollLeft=_)}if(i.target){const h=r(i.target);let L=i.target;h.forEach(_=>{const T=d(_,L);i.scrollContainers.push({element:_,startTop:m(_),targetTop:T.top,startLeft:w(_),targetLeft:T.left}),L=_})}else i.scrollContainers.push({element:i.element,startTop:m(i.element),targetTop:i.top??m(i.element),startLeft:w(i.element),targetLeft:i.left??w(i.element)});const $={linear:h=>h,easeInQuad:h=>h*h,easeOutQuad:h=>h*(2-h),easeInOutQuad:h=>h<.5?2*h*h:-1+(4-2*h)*h},A=$[i.easing]||$.easeInOutQuad;let v=0;const P=()=>{var h;o(""),i.target,(h=i.callback)==null||h.call(i)},O=h=>{v||(v=h);const L=h-v,_=Math.min(L/i.duration,1),T=A(_);i.scrollContainers.forEach(({element:S,startTop:E,targetTop:q,startLeft:y,targetLeft:U})=>{const k=E+(q-E)*T,D=y+(U-y)*T;p(S,k,D)}),L<i.duration?requestAnimationFrame(O):P()};requestAnimationFrame(O)})}async showInput(e,o,s){return new Promise((n,i)=>{F.runtime.sendMessage({action:"showInput",placeholder:e,defaultValue:o,max:s},r=>{n(r.value)})})}simpleUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const o=Math.random()*16|0;return(e==="x"?o:o&3|8).toString(16)})}formatDateTime(e,o=!1){if(typeof e=="string")e=new Date(e);else if(typeof e=="number")e=new Date(e);else if(!(e instanceof Date))return"";if(isNaN(e))return"";const s={year:e.getFullYear(),mounth:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),ms:e.getMilliseconds()},n=(r,l=2)=>(r+"").padStart(l,"0");let i=`${s.year}-${n(s.mounth)}-${n(s.day)} ${n(s.hour)}:${n(s.minute)}:${n(s.second)}`;return o&&(i+=`:${s.ms}`),i}formatDate(e){const o=this.formatDateTime(e);return o?o.split(" ")[0]:""}parseChineseNumber(e){const o={万亿:1e12,千亿:1e11,百亿:1e10,十亿:1e9,亿:1e8,千万:1e7,百万:1e6,万:1e4,千:1e3,百:100,十:10,k:1e3,K:1e3,m:1e6,M:1e6,b:1e9,B:1e9,t:1e12,T:1e12};let s="";for(const d in o)s?s+="|"+d:s+=d;const n=String(e).match(new RegExp(`^(\\d+.?\\d*)([${s})]*)`));if(!n)return 0;const i=parseFloat(n[1]),r=n[2].trim(),l=Object.keys(o).find(d=>r.startsWith(d)),c=l?o[l]:1;return r==="千万"?i*1e7:i*c}querySelector(e,o=[]){let s=null;for(const n of o){const i=n.match(/(.+):contains\(['"](.+)['"]\)/);if(i){const r=i[1],l=i[2];if(s=e.querySelector(r),s&&s.textContent.includes(l))break}else if(s=e.querySelector(n),s)break}return s}querySelectorAll(e,o=[]){for(const s of o){const n=s.match(/(.+):contains\(['"](.+)['"]\)/);if(n){const i=n[1],r=n[2],l=e.querySelectorAll(i);if(l&&l.length>0)return Array.from(l).filter(d=>d.textContent.includes(r))}else{const i=e.querySelectorAll(s);if(i.length>0)return Array.from(i)}}return[]}querySelectorWithText(e,o=[],s=""){let n=null;for(const i of o)if(n=e.querySelectorAll(i),n.length>0){for(const r of n)if(r.textContent.includes(s))return r}return null}querySelectorAllWithText(e,o=[],s=""){let n=null;for(const i of o)if(n=e.querySelectorAll(i),n.length>0)return Array.from(n).filter(r=>r.textContent.includes(s));return[]}}const V=new xt;function Tt(t){F.runtime.onMessage.addListener((e,o,s)=>{if(e.action==="getData")return console.log("收到获取数据请求"),(async()=>{try{const n=await Et(t);F.runtime.sendMessage({action:"dataReceived",data:n}),s({data:n})}catch(n){console.error("抓取数据时出错:",n),F.runtime.sendMessage({action:"dataError",error:n.message})}})(),s({action:"__default"}),!0})}async function Et(t){const e=window.location.href,o=St(e),s=bt(e);try{const n=await t(s,e);return console.log(`抓取到${s}数据:`,n),n.type=="unsupported"&&V.sendMessage("前页面不支持数据抓取"),await F.storage.local.set({[o]:{domain:s,type:n.type,data:n.data,timestamp:new Date().getTime(),fetchTime:n.fetchTime,url:e}}),n}catch(n){throw console.error("抓取过程中发生错误:",n),n}}const I={sniffedVideoUrl:"",sniffedVideoUrls:Array(),videoSearchAttempts:0},Ct=[".mp4",".m3u8",".webm",".flv","video","audio","play_url","video_url"];function de(t,e=0){if(e>5||!t||typeof t!="object")return;const o=window.location.href.includes("/search/")||window.location.href.includes("/discover/search"),s=["playAddr","play_url","downloadAddr","video_url","videoUrl","url","src","download_url","play_addr","video_id","mp4url","bitrate","urlList","video_list"];o&&s.push("source","media","mediaUrl","file","uri","display_url","srcUrl","videoResource","videoData","video_origin_url","main_url","backup_url","download_url","download_uri");for(const n in t){const i=t[n];if(s.includes(n)){if(typeof i=="string"&&i.includes("http")){if(console.log(`在对象属性${n}中找到视频URL:`,i),Ae(i),I.sniffedVideoUrl)return}else if(Array.isArray(i)){for(const r of i)if(typeof r=="string"&&r.includes("http")){if(console.log(`在对象属性${n}数组中找到视频URL:`,r),Ae(r),I.sniffedVideoUrl)return}else if(typeof r=="object"&&(de(r,e+1),I.sniffedVideoUrl))return}}if(o&&((n==="video"||n==="aweme"||n==="detail"||n==="item"||n==="media"||n==="stream")&&(console.log(`发现可能包含视频数据的对象: ${n}`),typeof i=="object"&&(de(i,e+1),I.sniffedVideoUrl))||typeof i=="string"&&(i.includes(".mp4")||i.includes("douyinvod.com")||i.includes("-dy.ixigua.com")||i.includes("v3-dy-o.zjcdn.com"))&&(console.log(`在属性${n}中找到视频URL:`,i),Ae(i),I.sniffedVideoUrl))||i&&typeof i=="object"&&(de(i,e+1),I.sniffedVideoUrl))return}}const It=["/media-audio"];function Ae(t){if(t){try{t=decodeURIComponent(t)}catch{}if(t.includes("v3-dy-o.zjcdn.com/")||t.includes("v26-dy.ixigua.com/")||t.includes("v9-dy.ixigua.com/")||t.includes("v3-dy.ixigua.com/")||t.includes("douyinvod.com/")||t.includes(".mp4")&&t.includes("douyin")){for(let e of It)if(t.includes(e))return;console.log("检测到抖音视频资源：",t),I.sniffedVideoUrls.includes(t)||(I.sniffedVideoUrls.push(t),console.log("新的视频URL已添加到数组，当前共有",I.sniffedVideoUrls.length,"个URL")),I.sniffedVideoUrl=t;return}for(let e of Ct)if(t.indexOf(e)!==-1){console.log("检测到媒体资源：",t),I.sniffedVideoUrls.includes(t)||I.sniffedVideoUrls.push(t),I.sniffedVideoUrl||(I.sniffedVideoUrl=t);break}}}/**
* @vue/shared v3.5.18
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function _t(t){const e=Object.create(null);for(const o of t.split(","))e[o]=1;return o=>o in e}const $t=Object.assign,qt=Object.prototype.hasOwnProperty,Ue=(t,e)=>qt.call(t,e),ce=Array.isArray,xe=t=>Je(t)==="[object Map]",Lt=t=>typeof t=="string",ue=t=>typeof t=="symbol",Te=t=>t!==null&&typeof t=="object",Vt=Object.prototype.toString,Je=t=>Vt.call(t),At=t=>Je(t).slice(8,-1),Me=t=>Lt(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Ee=(t,e)=>!Object.is(t,e);/**
* @vue/reactivity v3.5.18
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ut,et=0,ke;function Re(){et++}function De(){if(--et>0)return;let t;for(;ke;){let e=ke;for(ke=void 0;e;){const o=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(s){t||(t=s)}e=o}}if(t)throw t}let Ce=!0;const tt=[];function Mt(){tt.push(Ce),Ce=!1}function kt(){const t=tt.pop();Ce=t===void 0?!0:t}class Rt{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){}trigger(e){this.version++,this.notify(e)}notify(e){Re();try{for(let o=this.subs;o;o=o.prevSub)o.sub.notify()&&o.sub.dep.notify()}finally{De()}}}const Ne=new WeakMap,ie=Symbol(""),Oe=Symbol(""),fe=Symbol("");function K(t,e,o){if(Ce&&Ut){let s=Ne.get(t);s||Ne.set(t,s=new Map);let n=s.get(o);n||(s.set(o,n=new Rt),n.map=s,n.key=o),n.track()}}function oe(t,e,o,s,n,i){const r=Ne.get(t);if(!r)return;const l=c=>{c&&c.trigger()};if(Re(),e==="clear")r.forEach(l);else{const c=ce(t),d=c&&Me(o);if(c&&o==="length"){const a=Number(s);r.forEach((m,w)=>{(w==="length"||w===fe||!ue(w)&&w>=a)&&l(m)})}else switch((o!==void 0||r.has(void 0))&&l(r.get(o)),d&&l(r.get(fe)),e){case"add":c?d&&l(r.get("length")):(l(r.get(ie)),xe(t)&&l(r.get(Oe)));break;case"delete":c||(l(r.get(ie)),xe(t)&&l(r.get(Oe)));break;case"set":xe(t)&&l(r.get(ie));break}}De()}function ae(t){const e=H(t);return e===t?e:(K(e,"iterate",fe),se(t)?e:e.map(z))}function Pe(t){return K(t=H(t),"iterate",fe),t}const Dt={__proto__:null,[Symbol.iterator](){return We(this,Symbol.iterator,z)},concat(...t){return ae(this).concat(...t.map(e=>ce(e)?ae(e):e))},entries(){return We(this,"entries",t=>(t[1]=z(t[1]),t))},every(t,e){return J(this,"every",t,e,void 0,arguments)},filter(t,e){return J(this,"filter",t,e,o=>o.map(z),arguments)},find(t,e){return J(this,"find",t,e,z,arguments)},findIndex(t,e){return J(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return J(this,"findLast",t,e,z,arguments)},findLastIndex(t,e){return J(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return J(this,"forEach",t,e,void 0,arguments)},includes(...t){return He(this,"includes",t)},indexOf(...t){return He(this,"indexOf",t)},join(t){return ae(this).join(t)},lastIndexOf(...t){return He(this,"lastIndexOf",t)},map(t,e){return J(this,"map",t,e,void 0,arguments)},pop(){return me(this,"pop")},push(...t){return me(this,"push",t)},reduce(t,...e){return ot(this,"reduce",t,e)},reduceRight(t,...e){return ot(this,"reduceRight",t,e)},shift(){return me(this,"shift")},some(t,e){return J(this,"some",t,e,void 0,arguments)},splice(...t){return me(this,"splice",t)},toReversed(){return ae(this).toReversed()},toSorted(t){return ae(this).toSorted(t)},toSpliced(...t){return ae(this).toSpliced(...t)},unshift(...t){return me(this,"unshift",t)},values(){return We(this,"values",z)}};function We(t,e,o){const s=Pe(t),n=s[e]();return s!==t&&!se(t)&&(n._next=n.next,n.next=()=>{const i=n._next();return i.value&&(i.value=o(i.value)),i}),n}const Nt=Array.prototype;function J(t,e,o,s,n,i){const r=Pe(t),l=r!==t&&!se(t),c=r[e];if(c!==Nt[e]){const m=c.apply(t,i);return l?z(m):m}let d=o;r!==t&&(l?d=function(m,w){return o.call(this,z(m),w,t)}:o.length>2&&(d=function(m,w){return o.call(this,m,w,t)}));const a=c.call(r,d,s);return l&&n?n(a):a}function ot(t,e,o,s){const n=Pe(t);let i=o;return n!==t&&(se(t)?o.length>3&&(i=function(r,l,c){return o.call(this,r,l,c,t)}):i=function(r,l,c){return o.call(this,r,z(l),c,t)}),n[e](i,...s)}function He(t,e,o){const s=H(t);K(s,"iterate",fe);const n=s[e](...o);return(n===-1||n===!1)&&Jt(o[0])?(o[0]=H(o[0]),s[e](...o)):n}function me(t,e,o=[]){Mt(),Re();const s=H(t)[e].apply(t,o);return De(),kt(),s}const Ot=_t("__proto__,__v_isRef,__isVue"),nt=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(ue));function Pt(t){ue(t)||(t=String(t));const e=H(this);return K(e,"has",t),e.hasOwnProperty(t)}class it{constructor(e=!1,o=!1){this._isReadonly=e,this._isShallow=o}get(e,o,s){if(o==="__v_skip")return e.__v_skip;const n=this._isReadonly,i=this._isShallow;if(o==="__v_isReactive")return!n;if(o==="__v_isReadonly")return n;if(o==="__v_isShallow")return i;if(o==="__v_raw")return s===(n?i?Gt:lt:i?Yt:rt).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const r=ce(e);if(!n){let c;if(r&&(c=Dt[o]))return c;if(o==="hasOwnProperty")return Pt}const l=Reflect.get(e,o,ge(e)?e:s);return(ue(o)?nt.has(o):Ot(o))||(n||K(e,"get",o),i)?l:ge(l)?r&&Me(o)?l:l.value:Te(l)?n?ct(l):je(l):l}}class Wt extends it{constructor(e=!1){super(!1,e)}set(e,o,s,n){let i=e[o];if(!this._isShallow){const c=he(i);if(!se(s)&&!he(s)&&(i=H(i),s=H(s)),!ce(e)&&ge(i)&&!ge(s))return c?!1:(i.value=s,!0)}const r=ce(e)&&Me(o)?Number(o)<e.length:Ue(e,o),l=Reflect.set(e,o,s,ge(e)?e:n);return e===H(n)&&(r?Ee(s,i)&&oe(e,"set",o,s):oe(e,"add",o,s)),l}deleteProperty(e,o){const s=Ue(e,o);e[o];const n=Reflect.deleteProperty(e,o);return n&&s&&oe(e,"delete",o,void 0),n}has(e,o){const s=Reflect.has(e,o);return(!ue(o)||!nt.has(o))&&K(e,"has",o),s}ownKeys(e){return K(e,"iterate",ce(e)?"length":ie),Reflect.ownKeys(e)}}class Ht extends it{constructor(e=!1){super(!0,e)}set(e,o){return!0}deleteProperty(e,o){return!0}}const Ft=new Wt,jt=new Ht,Fe=t=>t,Ie=t=>Reflect.getPrototypeOf(t);function Kt(t,e,o){return function(...s){const n=this.__v_raw,i=H(n),r=xe(i),l=t==="entries"||t===Symbol.iterator&&r,c=t==="keys"&&r,d=n[t](...s),a=o?Fe:e?Ke:z;return!e&&K(i,"iterate",c?Oe:ie),{next(){const{value:m,done:w}=d.next();return w?{value:m,done:w}:{value:l?[a(m[0]),a(m[1])]:a(m),done:w}},[Symbol.iterator](){return this}}}}function _e(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function Bt(t,e){const o={get(n){const i=this.__v_raw,r=H(i),l=H(n);t||(Ee(n,l)&&K(r,"get",n),K(r,"get",l));const{has:c}=Ie(r),d=e?Fe:t?Ke:z;if(c.call(r,n))return d(i.get(n));if(c.call(r,l))return d(i.get(l));i!==r&&i.get(n)},get size(){const n=this.__v_raw;return!t&&K(H(n),"iterate",ie),Reflect.get(n,"size",n)},has(n){const i=this.__v_raw,r=H(i),l=H(n);return t||(Ee(n,l)&&K(r,"has",n),K(r,"has",l)),n===l?i.has(n):i.has(n)||i.has(l)},forEach(n,i){const r=this,l=r.__v_raw,c=H(l),d=e?Fe:t?Ke:z;return!t&&K(c,"iterate",ie),l.forEach((a,m)=>n.call(i,d(a),d(m),r))}};return $t(o,t?{add:_e("add"),set:_e("set"),delete:_e("delete"),clear:_e("clear")}:{add(n){!e&&!se(n)&&!he(n)&&(n=H(n));const i=H(this);return Ie(i).has.call(i,n)||(i.add(n),oe(i,"add",n,n)),this},set(n,i){!e&&!se(i)&&!he(i)&&(i=H(i));const r=H(this),{has:l,get:c}=Ie(r);let d=l.call(r,n);d||(n=H(n),d=l.call(r,n));const a=c.call(r,n);return r.set(n,i),d?Ee(i,a)&&oe(r,"set",n,i):oe(r,"add",n,i),this},delete(n){const i=H(this),{has:r,get:l}=Ie(i);let c=r.call(i,n);c||(n=H(n),c=r.call(i,n)),l&&l.call(i,n);const d=i.delete(n);return c&&oe(i,"delete",n,void 0),d},clear(){const n=H(this),i=n.size!==0,r=n.clear();return i&&oe(n,"clear",void 0,void 0),r}}),["keys","values","entries",Symbol.iterator].forEach(n=>{o[n]=Kt(n,t,e)}),o}function st(t,e){const o=Bt(t,e);return(s,n,i)=>n==="__v_isReactive"?!t:n==="__v_isReadonly"?t:n==="__v_raw"?s:Reflect.get(Ue(o,n)&&n in s?o:s,n,i)}const zt={get:st(!1,!1)},Qt={get:st(!0,!1)},rt=new WeakMap,Yt=new WeakMap,lt=new WeakMap,Gt=new WeakMap;function Xt(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Zt(t){return t.__v_skip||!Object.isExtensible(t)?0:Xt(At(t))}function je(t){return he(t)?t:at(t,!1,Ft,zt,rt)}function ct(t){return at(t,!0,jt,Qt,lt)}function at(t,e,o,s,n){if(!Te(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const i=Zt(t);if(i===0)return t;const r=n.get(t);if(r)return r;const l=new Proxy(t,i===2?s:o);return n.set(t,l),l}function he(t){return!!(t&&t.__v_isReadonly)}function se(t){return!!(t&&t.__v_isShallow)}function Jt(t){return t?!!t.__v_raw:!1}function H(t){const e=t&&t.__v_raw;return e?H(e):t}const z=t=>Te(t)?je(t):t,Ke=t=>Te(t)?ct(t):t;function ge(t){return t?t.__v_isRef===!0:!1}/*!
 * pinia v3.0.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */var dt;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(dt||(dt={}));const Be=()=>({feishu:{label:"飞书多维表格设置",feishu_base_url:{value:"",max:200,defalutVaue:"",label:"多维表格URL",placeholder:"多维表格URL 例如: https://mideqnf1p7d.feishu.cn/base/TAAsbKNniaMaodss84tcEQSun3f?table=tbllpvh8BykaNQBM&view=vewvd05oOX"}},dignding:{label:"钉钉AI表格设置",appKey:{value:"",max:100,defalutVaue:"",label:"appKey",placeholder:"appKey"},appSecret:{value:"",max:100,defalutVaue:"",label:"appSecret",placeholder:"appSecret"},baseId:{value:"",max:100,defalutVaue:"",label:"baseId",placeholder:"baseId 文档Id"},phone:{value:"",max:100,defalutVaue:"",label:"手机号",placeholder:"钉钉用户绑定的手机号码"}},douyin:{label:"抖音设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxUserVideoCount:{value:100,max:200,defalutVaue:100,label:"最大用户视频数量",placeholder:"最大用户视频数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},xiaohongshu:{label:"小红书设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxUserNoteCount:{value:100,max:200,defalutVaue:100,label:"最大用户笔记数量",placeholder:"最大用户笔记数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},jd:{label:"京东设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},taobao:{label:"淘宝设置",maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},sycm_taobao:{label:"生意参谋设置",maxOverviewDataCount:{value:100,max:200,defalutVaue:100,label:"最大客户概况数量",placeholder:"最大客户概况数量"},maxCustomerTripDataCount:{value:100,max:200,defalutVaue:100,label:"最大客户旅程数量",placeholder:"最大客户旅程数量"},maxCustomerTripGoodsDataCount:{value:100,max:200,defalutVaue:100,label:"最大客户旅程商品数量",placeholder:"最大客户旅程商品数量"}},one_alimama:{label:"阿里妈妈万象台设置",maxGoodsListCount:{value:100,max:200,defalutVaue:100,label:"最大商品数量",placeholder:"最大商品数量"}},tiktok:{label:"tiktok设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxUserVideoCount:{value:100,max:200,defalutVaue:100,label:"最大用户视频数量",placeholder:"最大用户视频数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},youtube:{label:"tiktok设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxUserVideoCount:{value:100,max:200,defalutVaue:100,label:"最大用户视频数量",placeholder:"最大用户视频数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}}});let eo=Be();je(eo);const ut="__setting",ze=async()=>{var e=(await F.storage.local.get([ut]))[ut];if(e){const s=e;var o=Be();return Object.keys(o).forEach(n=>{n in s||(s[n]=o[n])}),s}else return Be()};async function to(){var ye;console.log("开始抓取抖音视频详情modal..."),console.log("当前URL:",window.location.href),console.log("是否包含modal_id:",window.location.href.includes("modal_id="));const e=(await ze()).douyin.maxCommentsCount.value;I.sniffedVideoUrl="",I.sniffedVideoUrls?console.log("已有嗅探视频URL列表，共",I.sniffedVideoUrls.length,"个"):I.sniffedVideoUrls=[],I.videoSearchAttempts=0;let o=!1,s="";const n=window.location.href.match(/modal_id=([0-9]+)/);if(n&&n[1])s=n[1],console.log("从URL提取视频ID:",s);else{const u=window.location.href.match(/(\/video\/(\d+)$)|(\/video\/(\d+)[?|\/])/);if(u&&u[2]||u[4])s=u[2]||u[4],o=!0,console.log("从URL提取视频ID:",s);else return console.error("URL中未找到modal_id参数"),V.sendMessage("请确认当前URL包含modal_id参数"),{}}const i=window.location.href.includes("/search/")||window.location.href.includes("/discover/search");if(console.log("视频弹窗来源:",i?"搜索页面":"用户页面/其他"),i){console.log("检测到来自搜索页的视频弹窗，使用增强嗅探"),await new Promise(f=>setTimeout(f,1e3));const u=["video.xgplayer-video",".xg-video video",".player-container video",".xgplayer-inner video",'[class*="player"] video'];for(const f of u){let g=Array.from(document.querySelectorAll(f));console.log(`使用选择器 "${f}" 找到 ${g.length} 个视频元素`),g.length==2?g=[g[0]]:g.length>2&&(g=[g[1]]);for(const x of g)try{if(x&&!x.src&&(console.log("尝试播放视频以触发资源加载"),x.play().catch(C=>console.log("播放视频失败，这是预期的行为")),await new Promise(C=>setTimeout(C,500))),x.src&&(console.log("找到视频元素src:",x.src),(x.src.includes("v3-dy-o.zjcdn.com/")||x.src.includes("v26-dy.ixigua.com/")||x.src.includes("v9-dy.ixigua.com/")||x.src.includes("v3-dy.ixigua.com/")||x.src.includes("douyinvod.com/")||x.src.includes(".mp4")&&x.src.includes("douyin"))&&(I.sniffedVideoUrl=x.src,console.log("在搜索页视频元素中找到视频URL:",I.sniffedVideoUrl))),!I.sniffedVideoUrl){const C=x.attributes;for(let N=0;N<C.length;N++){const M=C[N].name,b=C[N].value;if(M.startsWith("data-")&&b&&(b.includes(".mp4")||b.includes("douyinvod")||b.includes("-dy.")||b.includes("v3-dy"))){console.log(`在视频元素的属性 ${M} 中找到可能的URL:`,b);try{const W=JSON.parse(b);de(W)}catch{b.startsWith("http")&&(I.sniffedVideoUrl=b,console.log("从视频属性中获取视频URL:",I.sniffedVideoUrl))}}}}}catch(C){console.error("处理视频元素时出错:",C)}if(I.sniffedVideoUrl)break}if(!I.sniffedVideoUrl){const f=document.querySelectorAll('.xgplayer, [class*="player"], [class*="Player"], .swiper-slide-active');console.log(`找到 ${f.length} 个可能的播放器容器`);for(const g of f)try{const x=g.attributes;for(let N=0;N<x.length;N++){const M=x[N].name,b=x[N].value;if(b&&(b.includes(".mp4")||b.includes("douyinvod")||b.includes("-dy.")||b.includes("v3-dy"))&&(console.log(`在播放器容器的属性 ${M} 中找到可能的URL:`,b),b.startsWith("http"))){I.sniffedVideoUrl=b,console.log("从播放器容器属性中获取视频URL:",I.sniffedVideoUrl);break}if(M.startsWith("data-"))try{const W=JSON.parse(b);if(de(W),I.sniffedVideoUrl)break}catch{}}if(I.sniffedVideoUrl)break;const C=g.style.backgroundImage;if(C){console.log("播放器容器背景图片:",C);const N=C.match(/\/([0-9]+)~noop/);if(N&&N[1]){const M=N[1];console.log("从背景图片中提取可能的视频ID:",M)}}}catch(x){console.error("处理播放器容器时出错:",x)}}if(!I.sniffedVideoUrl&&(console.log("尝试拦截网络请求查找视频URL"),window.performance&&window.performance.getEntries)){const f=window.performance.getEntries();console.log(`分析 ${f.length} 个网络请求`);for(const g of f)try{if(g.name&&typeof g.name=="string"&&(g.name.includes("douyinvod.com")||g.name.includes("v3-dy")||g.name.includes("v26-dy")||g.name.includes("v9-dy")||g.name.includes(".mp4")&&g.name.includes("douyin"))){console.log("从网络请求中找到视频URL:",g.name),I.sniffedVideoUrl=g.name;break}}catch(x){console.error("分析网络请求时出错:",x)}}}for(let u=0;u<3;u++){let f=Array.from(document.querySelectorAll("video"));f.length==2?f=[f[0]]:f.length>2&&(f=[f[1]]);for(const g of f)await V.waitForChildListChange(()=>{g.src=g.src+"?t="+Date.now()},g),await V.sleep(500),g.src&&(console.log("视频modal中发现视频元素src:",g.src),(g.src.includes("v3-dy-o.zjcdn.com/")||g.src.includes("v26-dy.ixigua.com/")||g.src.includes("v9-dy.ixigua.com/")||g.src.includes("v3-dy.ixigua.com/")||g.src.includes("douyinvod.com/")||g.src.includes(".mp4")&&g.src.includes("douyin"))&&(I.sniffedVideoUrl=g.src,console.log("在视频元素中找到视频URL:",I.sniffedVideoUrl))),g.querySelectorAll("source").forEach(C=>{C.src&&(console.log("发现视频source标签src:",C.src),(C.src.includes("v3-dy-o.zjcdn.com/")||C.src.includes("v26-dy.ixigua.com/")||C.src.includes("v9-dy.ixigua.com/")||C.src.includes("v3-dy.ixigua.com/")||C.src.includes("douyinvod.com/")||C.src.includes(".mp4")&&C.src.includes("douyin"))&&(I.sniffedVideoUrl=C.src,console.log("在source标签中找到视频URL:",I.sniffedVideoUrl)))});if(!I.sniffedVideoUrl){console.log("第",u+1,"次尝试从HTML中搜索视频URL");const g=[/https:\/\/v3-web\.douyinvod\.com\/[^"'\s]+/g,/https:\/\/v(\d+)-\w+\.douyinvod\.com\/[^"'\s]+/g,/https:\/\/v(\d+)-dy\.ixigua\.com\/[^"'\s]+/g,/https:\/\/v(\d+)-dy-o\.zjcdn\.com\/[^"'\s]+/g,/"playAddr":\s*"([^"]+)"/g,/"play_url":\s*"([^"]+)"/g,/"downloadAddr":\s*"([^"]+)"/g,/playAddr:\s*'([^']+)'/g,/src="(https:\/\/[^"]+\.mp4[^"]*)"/g],x=document.documentElement.outerHTML;for(const C of g){const N=x.match(C);if(N&&N.length){for(const M of N){let b=M;if(M.includes('playAddr":')||M.includes('play_url":')||M.includes('downloadAddr":')){const W=/":\s*"([^"]+)"/.exec(M);W&&W[1]&&(b=W[1].replace(/\\u002F/g,"/"))}else if(M.includes("playAddr:")){const W=/'([^']+)'/.exec(M);W&&W[1]&&(b=W[1].replace(/\\u002F/g,"/"))}else if(M.includes('src="')){const W=/src="([^"]+)"/.exec(M);W&&W[1]&&(b=W[1])}if(console.log("从HTML中找到可能的视频URL:",b),b&&(b.includes("v3-dy-o.zjcdn.com/")||b.includes("v26-dy.ixigua.com/")||b.includes("v9-dy.ixigua.com/")||b.includes("v3-dy.ixigua.com/")||b.includes("douyinvod.com/")||b.includes(".mp4")&&b.includes("douyin"))){I.sniffedVideoUrl=b,console.log("从HTML中确认视频URL:",I.sniffedVideoUrl);break}}if(I.sniffedVideoUrl)break}}}if(!I.sniffedVideoUrl&&window.RENDER_DATA)try{let g=function(C,N=0){if(!(N>5)&&!(!C||typeof C!="object")){for(const M in C){if(M==="playAddr"||M==="play_url"||M==="downloadAddr"||M==="video_url"||M==="url"){const b=C[M];if(typeof b=="string"&&b.includes("http")&&(console.log(`在RENDER_DATA.${M}中找到视频URL:`,b),b.includes("v3-dy-o.zjcdn.com/")||b.includes("v26-dy.ixigua.com/")||b.includes("v9-dy.ixigua.com/")||b.includes("v3-dy.ixigua.com/")||b.includes("douyinvod.com/")||b.includes(".mp4")&&b.includes("douyin")))return I.sniffedVideoUrl=b,!0}if(C[M]&&typeof C[M]=="object"&&g(C[M],N+1))return!0}return!1}};console.log("尝试从RENDER_DATA提取视频URL");const x=JSON.parse(decodeURIComponent(window.RENDER_DATA));g(x)}catch(g){console.log("从RENDER_DATA解析视频URL失败:",g)}if(I.sniffedVideoUrl){console.log("成功找到视频URL，中止进一步搜索");break}u<2&&(console.log("未找到视频URL，等待500ms后再次尝试"),await new Promise(g=>setTimeout(g,500)))}const r=document.querySelectorAll("video");console.log(`找到 ${r.length} 个视频元素`),r.forEach(u=>{u.src&&(console.log("检查视频源URL:",u.src),(u.src.startsWith("https://v3-dy-o.zjcdn.com/")||u.src.startsWith("https://v26-dy.ixigua.com/")||u.src.startsWith("https://v9-dy.ixigua.com/")||u.src.startsWith("https://v3-dy.ixigua.com/"))&&(I.sniffedVideoUrl=u.src,console.log("直接从视频元素获取到视频URL:",I.sniffedVideoUrl)))}),I.sniffedVideoUrl||console.log("没有立即找到视频URL，将在后台继续嗅探");const l=document.querySelectorAll('.xgplayer-play, .xgplayer-start, [data-e2e="video-play"]');if(l.length>0){console.log("找到播放按钮，点击以触发视频加载");try{l[0].getAttribute("data-state")!="play"&&l[0].click()}catch(u){console.error("点击播放按钮失败:",u)}}console.log("通过data-e2e-vid和video_ID属性查找当前视频元素...");let c=document.querySelector(`div[data-e2e="feed-active-video"][data-e2e-vid="${s}"]`);if(c||(c=document.querySelector(`.video_${s}`),console.log("通过video_class查找:",c?"找到了":"未找到")),!c){const u=document.querySelectorAll('div[data-e2e="feed-active-video"]');console.log(`找到${u.length}个feed-active-video元素`);for(const f of u)if(console.log("检查元素:",f.getAttribute("data-e2e-vid"),f.className),f.className.includes("ZTBYOIeC")&&(f.getAttribute("data-e2e-vid")===s||f.className.includes(`video_${s}`))){c=f,console.log("找到匹配的活跃视频元素!");break}}o&&(c=c.parentElement);let d=null;if(c)console.log("找到活跃视频元素:",c),console.log("活跃视频元素data-e2e-vid:",c.getAttribute("data-e2e-vid")),console.log("活跃视频元素class:",c.className),d=c;else{console.log("未找到精确匹配的活跃视频元素，回退到常规查找方式...");const u=['div[data-e2e="modal-video-container"]',".vtCDirga.modal-video-container",".vtCDirga.modal-video-container.m3vr37Qp",".modal-video-container",".AXQAavwp"];let f=null,g=0;const x=10,C=500;for(;!f&&g<x;){console.log(`尝试查找modal容器，第${g+1}次尝试...`);for(const N of u){const M=document.querySelector(N);if(M){f=M,console.log(`在第${g+1}次尝试中找到modal容器，使用选择器:`,N);break}}f||(g++,await new Promise(N=>setTimeout(N,C)))}if(!f){console.log("尝试使用MutationObserver等待modal容器加载...");try{f=await Ve(u.join(", "),5e3)}catch(N){console.error("等待modal容器加载超时:",N)}}if(!f)return console.error("未找到视频modal容器"),console.log("当前页面结构:"),console.log(document.body.innerHTML.substring(0,500)+"..."),V.sendMessage("未找到视频详情容器，请确认当前页面包含视频详情弹窗"),{};d=f,console.log("找到备选视频modal容器:",d)}console.log("Modal container HTML (前300字符):"),console.log(d.innerHTML.substring(0,300)+"...");let a="";const m=d.querySelector(".slider-video .hiddenImgbackgroundPlugin");m&&m.src&&(a=m.src,console.log("提取到封面图:",a));let w="";const p=["div.video-info-detail div.title div>span>span>span:first-child ",`div[data-e2e-aweme-id="${s}"] span>span>span`,'div[data-e2e="video-desc"], .video-desc, .title, .desc, .HKxbhvW_',".title-wrap h1",".video-info-title","span.JI6vfzjc"];for(const u of p){const f=d.querySelector(u);if(f&&f.textContent.trim()){const g=f.cloneNode(!0),x=g.querySelectorAll('button, [role="button"], .expand-btn, [class*="expand"]');if(x.forEach(C=>{C&&C.parentNode&&C.parentNode.removeChild(C)}),w=g.textContent.trim(),console.log(`从选择器 ${u} 提取到纯标题(不含按钮文本):`,w),x.length>0){console.log("在标题元素中找到展开按钮:",x.length);try{const C=f.querySelectorAll('button, [role="button"], .expand-btn, [class*="expand"]');C&&C.length>0&&(C[0].click(),console.log("点击展开按钮展开完整标题"),setTimeout(()=>{if(f){const N=f.cloneNode(!0);N.querySelectorAll('button, [role="button"], .expand-btn, [class*="expand"]').forEach(W=>{W&&W.parentNode&&W.parentNode.removeChild(W)});const b=N.textContent.trim();b&&b.length>w.length&&(w=b,console.log("展开后获取到更完整的标题(不含按钮文本):",w))}},300))}catch(C){console.log("点击展开按钮失败:",C)}}break}}let $="",A="",v="",P="";const O=u=>{if(u.tagName==="A"&&u.href){v=u.href;const f=v.match(/\/user\/([^?]+)/);f&&f[1]&&(A=f[1]),console.log("作者链接:",v),console.log("作者ID:",A)}},h=[`div[data-e2e-aweme-id="${s}"] span>span>span>span:last-child>a`,'a[data-e2e="video-author"], .video-author-name, .J6IbfgxH',".author-name span",".account-name",'a.hY8lWHgA, a[href*="/user/"]','[data-e2e="related-video"] [data-e2e="user-info"]>div:nth-child(2) a[href*="/user/"]'];for(const u of h){const f=d.querySelector(u);if(f&&($=f.textContent.trim(),console.log(`从选择器 ${u} 提取到作者:`,$),O(f),$))break}if(!A||!v){const u=V.querySelector(d,['a[data-e2e="video-avatar"]']);u&&O(u)}const L=V.querySelector(d,['[data-e2e="related-video"] [data-e2e="user-info"] a>span[data-e2e="live-avatar"]>img','a>div>span[data-e2e="live-avatar"]>img']);L&&(P=L.src||"");let _="";const T=['span[data-e2e="detail-video-publish-time"]','.video-info-detail .SqVMXNQp, .publish-time, div[data-e2e="video-publish-time"]',".video-create-time",".create-time",".time-info"];for(const u of T){const f=d.querySelector(u);if(f&&f.textContent.trim()){_=f.textContent.trim().replace(/^[·\s]+/,""),console.log(`从选择器 ${u} 提取到发布时间:`,_);break}}let S="",E="",q="",y="";const U=['div[data-e2e="video-player-digg"]>div:last-child','div[data-e2e="video-player-digg"] .M7M0nmSI','div[data-e2e="video-player-digg"] + div','div[data-e2e="video-player-digg"] .count','div[data-e2e-state="video-player-digged"] .M7M0nmSI'];for(const u of U){const f=d.querySelector(u);if(f&&f.textContent.trim()){S=f.textContent.trim(),console.log(`从选择器 ${u} 提取到点赞数:`,S);break}}const k=['div[data-e2e="feed-comment-icon"]>div:last-child','div[data-e2e="feed-comment-icon"] .SfwAcdr1','div[data-e2e="feed-comment-icon"] .JrV13Yco','div[data-e2e="feed-comment-icon"] .count'];for(const u of k){const f=d.querySelector(u);if(f&&f.textContent.trim()){E=f.textContent.trim(),console.log(`从选择器 ${u} 提取到评论数:`,E);break}}const D=['div[data-e2e="video-player-collect"]>div:last-child','div[data-e2e="video-player-collect"] .JQCocDWm','div[data-e2e="video-player-collect"] .NT67BHnx','div[data-e2e="video-player-collect"] .count','div[data-e2e-state="video-player-collected"] .JQCocDWm'];for(const u of D){const f=d.querySelector(u);if(f&&f.textContent.trim()){q=f.textContent.trim(),console.log(`从选择器 ${u} 提取到收藏数:`,q);break}}const G=['div[data-e2e="video-player-share"]>div:last-child','div[data-e2e="video-player-share"] .MQXEGdYW','div[data-e2e="video-player-share"] .count'];for(const u of G){const f=d.querySelector(u);if(f&&f.textContent.trim()){y=f.textContent.trim(),console.log(`从选择器 ${u} 提取到分享数:`,y);break}}let B="";const Q=d.querySelector(".ckopQfVu, .video-duration, .time-duration, span.time-duration");if(Q)B=Q.textContent.trim();else{const u=d.querySelector(".xgplayer-time")||document.querySelector(".xgplayer-time");if(u)B=((ye=u.textContent.trim().split("/").pop())==null?void 0:ye.trim())||"";else{const f=d.querySelector(".current-time")||document.querySelector(".current-time");f&&(B=f.textContent.trim())}}console.log("提取到时长:",B);let j="";const re=[".tag-item","div.video-info-detail div.title div>span>span>span>a"];for(const u of re){const f=d.querySelectorAll(u);if(f.length>0){f.forEach(g=>{const x=g.textContent.trim();x&&(j+=x+", ")});break}}j=j.trim(),console.log("提取到标签:",j);let ee="";const X=d.querySelector(".music-info");X&&X.textContent.trim()&&(ee=X.textContent.trim(),console.log("提取到音乐信息:",ee));const ne=V.parseChineseNumber(E),ve=await ft(ne>e?e:ne,o),Z={author:{id:A,name:$,avatar:P,link:v},post:{id:s,title:w,coverImage:a,description:w,link:`https://www.douyin.com/video/${s}`,duration:B,publishTime:_,musicInfo:ee,tags:j},interactions:{likes:S,comments:E,favorites:q,shares:y},mediaContent:[{type:"video",mediaUrl:I.sniffedVideoUrl,cover:""}],commentsList:ve.map(u=>({userName:u.userName||"",avatar:u.avatar||"",content:u.content||"",likes:u.likes||"0",date:u.date||"",location:u.location||"",isAuthor:u.isAuthor||!1}))};console.log("数据抓取完成，尝试打开评论");try{if(console.log("尝试创建视频URL列表UI元素"),I.sniffedVideoUrls&&I.sniffedVideoUrls.length>0){const u=document.querySelector('.AXQAavwp div[data-e2e="video-info"], .video-info-detail');if(u){const f=document.createElement("div");f.className="video-urls-container",f.style.cssText="margin-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px;";const g=document.createElement("div");g.textContent=`视频URL列表 (共${I.sniffedVideoUrls.length}个)`,g.style.cssText="color: #f85959; font-weight: bold; margin-bottom: 5px; font-size: 14px;",f.appendChild(g);const x=document.createElement("div");x.className="video-urls-list",x.style.cssText="max-height: 120px; overflow-y: auto; font-size: 12px;",I.sniffedVideoUrls.forEach((C,N)=>{const M=document.createElement("div");M.className="video-url-item",M.style.cssText="margin-bottom: 5px; word-break: break-all; color: #fff;";const b=document.createElement("a");b.href=C,b.textContent=`${N+1}. ${C.slice(0,50)}...`,b.title=C,b.target="_blank",b.style.cssText="color: #66ccff; text-decoration: none;",b.onclick=function(W){return W.stopPropagation(),navigator.clipboard.writeText(C).then(()=>{alert("视频URL已复制到剪贴板")}).catch(Xe=>{console.error("复制失败: ",Xe)}),!1},M.appendChild(b),x.appendChild(M)}),f.appendChild(x),u.appendChild(f),console.log("成功添加视频URL列表UI")}else console.error("未找到合适的视频信息容器来添加URL列表")}else console.log("没有嗅探到的视频URL列表可显示")}catch(u){console.error("添加视频URL列表UI时出错:",u)}try{const u=['div[data-e2e="feed-comment-icon"]','div[data-e2e="video-player-comment"]','div[class*="comment-icon"]'];let f=null;for(const g of u){const x=d.querySelector(g);if(x){f=x,console.log(`找到评论按钮: ${g}`);break}}if(f){console.log("点击评论按钮打开评论面板"),f.click(),V.sendMessage("已打开评论面板，准备抓取评论..."),await new Promise(x=>setTimeout(x,2e3));const g=await ft(e);Z.commentsList=g.map(x=>({userName:x.userName||"",avatar:x.avatar||"",content:x.content||"",likes:x.likes||"0",date:x.date||"",location:x.location||"",isAuthor:x.isAuthor||!1})),V.sendMessage(`已抓取 ${g.length} 条评论`),g.length>0?console.log(`成功抓取 ${g.length} 条评论，已添加到结果数据`):console.log("未抓取到评论，已添加空评论列表到结果数据")}else console.log("未找到评论按钮，无法打开评论")}catch(u){console.error("抓取评论过程出错:",u)}return console.log("最终嗅探到的视频URL:",I.sniffedVideoUrl),console.log("抓取结果:",Z),Z}async function ft(t=100,e=!1){console.log(`开始抓取视频评论，最多 ${t} 条`);const o=document.querySelector('[data-e2e="comment-list"]');if(!o){if(console.error('未找到评论容器 [data-e2e="comment-list"]'),!document.getElementById("merge-all-comment-container"))return console.error("备用容器也未找到，无法抓取评论"),[];console.log("使用备用评论容器进行抓取")}const s=o||document.getElementById("merge-all-comment-container");console.log("找到评论容器，开始处理评论");let n=t;try{const p=document.querySelector(".qx5s_hbj");if(p&&p.textContent){const $=p.textContent.match(/\((\d+)\)/);$&&$[1]&&(n=parseInt($[1],10),console.log(`找到评论总数: ${n}`),n<t&&(t=n,console.log(`调整抓取目标为实际评论总数: ${t}`)))}}catch(p){console.error("获取评论总数出错:",p)}const i=[],r=new Set;let l=0,c=0;V.sendMessage(`准备抓取评论，总评论数: ${n}`);async function d(p=0,$=30){if(V.sendMessage(`正在抓取评论 ${i.length}/${t}...`),p>=$||i.length>=t||c>=5){c>=5?console.log(`连续 ${c} 次没有新评论加载，停止抓取`):p>=$?console.log(`达到最大尝试次数 ${$}，停止抓取`):console.log(`已抓取目标数量 ${i.length}/${t} 条评论`);return}if(await m(),i.length>l?(console.log(`本次新增 ${i.length-l} 条评论`),l=i.length,c=0):(c++,console.log(`没有新评论加载，连续无变化次数: ${c}`)),i.length<t){await w();const v=500+Math.min(200,p*20);console.log(`等待 ${v}ms 加载新评论...`),await new Promise(P=>setTimeout(P,v)),await d(p+1,$)}}let a=0;async function m(){const p=s.querySelectorAll('div[data-e2e="comment-item"]');console.log(`当前找到 ${p.length} 条评论元素`);let $=0;for(const A of p){$++;try{if($<=a)continue;a++,V.scrollToElementTop(A),await V.waitElementInViewportUseObserver(A),await V.sleep(50);const v=V.querySelector(A,[".comment-item-info-wrap span>span>span",".j5WZzJdp.E7y2ZDk0"]),P=v?v.textContent.trim():"",O=V.querySelector(A,[".comment-item-info-wrap +div",".LvAtyU_f .sU2yAQQU"]);let h=O?O.textContent.trim():"";const L=V.querySelector(A,[".comment-item-info-wrap +div +div",".GOkWHE6S"]),_=L?L.textContent.trim():"";let T="",S="";if(_){const D=_.split("·");T=D[0]?D[0].trim():"",S=D[1]?D[1].trim():""}const E=V.querySelector(A,[".comment-item-info-wrap +div +div +div .comment-item-stats-container>div:first-child",".wiQmZrKV span"]);A.querySelector(".wiQmZrKV span");const q=E?E.textContent.trim():"",y=V.querySelector(A,[".comment-item-avatar a img"]),U=y?y.src:"",k=`${P}-${h.substring(0,50)}-${$}`;if(!r.has(k)&&(r.add(k),i.push({userName:P,avatar:U,content:h,likes:q,date:T,location:S,isAuthor:!1}),i.length>=t)){console.log(`已达到最大评论数 ${t}`);break}}catch(v){console.error("处理评论元素时出错:",v)}}}async function w(){console.log("开始快速滚动加载更多评论");let p=s;if(e&&(p=document.querySelector("#douyin-right-container>div.parent-route-container")),!p)return;const $=p.scrollTop;p.scrollHeight;const A=p.clientHeight,v=p.scrollHeight-A;if(v-$<200){p.scrollTop=v,console.log(`直接滚动到底部: ${$} -> ${p.scrollTop}`);return}const P=Math.min(1500,p.scrollHeight/1.5);p.scrollTop=$+P,console.log(`完成快速滚动: ${$} -> ${p.scrollTop}, 滚动距离: ${p.scrollTop-$}px`)}return console.log("开始滚动加载评论..."),await d(0,50),console.log(`评论抓取完成，共抓取 ${i.length}/${n} 条评论`),V.sendMessage(`已抓取 ${i.length}/${n} 条评论`),i.filter(p=>p.userName&&p.content)}async function oo(){console.log("开始抓取抖音搜索页数据...");const t={searchGeneral:"searchGeneral",searchVideo:"searchVideo"},e=window.location.href;let o=t.searchGeneral;e.includes("type=general")?o=t.searchGeneral:e.includes("type=video")&&(o=t.searchVideo);class s{constructor(a){R(this,"type");R(this,"videoListContainer");R(this,"videoListContainerSelector");this.type=a,this.videoListContainer=null}async getData(a=100){if(this.type===t.searchGeneral)return this.videoListContainerSelector="div#waterFallScrollContainer",this.videoListContainer=document.querySelector(this.videoListContainerSelector),console.log("视频综合容器:",this.videoListContainer),await this.scrapeGeneral(a);if(this.type===t.searchVideo){if(this.videoListContainerSelector='div#search-result-container>div[style*="display: block"]:nth-child(2)',this.videoListContainer=document.querySelector(`${this.videoListContainerSelector}>ul[data-e2e="scroll-list"]`),console.log("视频列表容器:",this.videoListContainer),!this.videoListContainer){console.log("未找到视频列表容器，尝试其他选择器...");const m=['ul[data-e2e="scroll-list"]','ul[class*="gZq36zrh"]','ul[class*="PAjzsG5a"]',".search-result-container > ul",'div[data-e2e="search-result-container"] > ul'];for(const w of m){const p=document.querySelector(w);if(p){console.log(`找到容器，使用选择器: ${w}`),this.videoListContainer=p;break}}}return await this.scrapeVideos(a)}}async scrapeGeneral(a=100,m=[],w=0,p=10){var _,T;let $=!1;const A=document.querySelectorAll(`${this.videoListContainerSelector}>div:last-child`);for(const S of A)if(V.getTextNodeValue(S).includes("暂时没有更多了")){console.log('检测到"暂时没有更多了"提示，已到达页面底部'),$=!0;break}if($&&m.length>0)return console.log("已抓取到底部，返回当前结果"),m;let v=null;this.videoListContainer&&(v=Array.from(this.videoListContainer.querySelectorAll("div.search-result-card")),console.log(`从容器中找到 ${v.length} 个视频项`)),(!v||v.length===0)&&(console.log("在容器中未找到视频项，尝试在全页面中查找..."),v=Array.from(document.querySelectorAll("div.search-result-card")),console.log(`在全页面中找到 ${v.length} 个视频项`));function P(S,E=5){const q=[];let y=S,U=0;for(;y&&U<E;){const k=y.className?` (class="${y.className}")`:"",D=y.id?` (id="${y.id}")`:"";q.push(`${y.tagName.toLowerCase()}${k}${D}`),y=y.parentElement,U++}return q}if(!v||v.length===0){console.log("未找到视频项，输出页面结构以辅助调试:");const S=document.querySelectorAll('a[href*="/video/"]');console.log("包含/video/字符串的链接数量:",S.length),S.length>0&&(console.log("第一个视频链接:",S[0]),console.log("包含该链接的父元素链:",P(S[0])));const E=document.querySelectorAll("li");console.log("页面上的列表项数量:",E.length),console.log("页面上前5个列表项的类名:");for(let q=0;q<Math.min(5,E.length);q++)if(console.log(`列表项 ${q+1} 类名:`,E[q].className),E[q].querySelector('a[href*="/video/"]')){console.log(`列表项 ${q+1} 包含视频链接`),v=[E[q]];break}}const O=[],h=new Set(m.map(S=>S.link));for(let S=0;S<v.length;S++){const E=v[S];console.log(`处理第 ${S+1}/${v.length} 个视频数据 (总计 ${m.length+O.length}/${a})`);let q=(_=E.querySelector("div#sliderVideo"))==null?void 0:_.getAttribute("data-e2e-vid");q||(q=E.parentElement.id.split("_").length==3?E.parentElement.id.split("_")[2]:"");let y="";if(q){if(y=`https://www.douyin.com/video/${q}`,h.has(y)){console.log("跳过重复视频:",y);continue}console.log("提取到链接:",y)}else{console.log("未找到链接元素，跳过此项");continue}if((T=E.querySelector(".semi-tag-content.semi-tag-content-ellipsis"))!=null&&T.textContent.includes("直播中")){console.log("跳过直播视频，index:",S);continue}const U=E.querySelector('.FWkvEMo5, img[src*="douyinpic"]');let k="";if(U){if(U.style&&U.style.backgroundImage){const f=U.style.backgroundImage.match(/url\(['"]?(.*?)['"]?\)/);f&&f[1]&&(k=f[1])}else U.src&&(k=U.src);console.log("提取到封面图:",k)}else console.log("未找到封面图元素");const D=E.querySelector(".BjLsdJMi , .j5WZzJdp.IoRNNcMW.hVNC9qgC"),G=D?D.innerText.trim():"";if(console.log("提取到标题:",G),!G)continue;let B;const Q=E.querySelector(".VuNDHHqb");if(Q){Q.click();const u=await Ve(".transition-mask-appear-done");if(u){const g=async()=>{for(let Y=0;Y<5;Y++){const we=await Ve(".transition-mask-appear-done .vs9hmvGz"),be=we?we.innerText.trim():"";if(be)return be}};await V.sleep(1e3);const x=await g(),C=u.querySelector(".sULNCyZ4>span"),N=C?C.innerText.trim():"",M=u.querySelector(".r9__IJQQ"),b=M?M.innerText.trim():"",W=u.querySelector(".SDhAOg0k"),Xe=W?W.innerText.trim():"",uo=u.querySelectorAll(".swiper-wrapper>div.swiper-slide img"),gt=new Set;uo.forEach(Y=>{gt.add(Y.src)});const fo=Array.from(gt),pt=[];u.querySelectorAll(".hIRfCKxu").forEach(Y=>{const we=Y.querySelector(".dxbiuoJ_"),be=Y.querySelector(".GmHYc224");pt.push({name:we?we.innerText.trim():"",value:be?be.innerText.trim():""})});const vt=u.querySelectorAll(".p1kE0uFd.S25T9aPi .nPQ6wC4v"),mo=vt?Array.from(vt).map(Y=>Y.src).filter(Y=>Y&&!Y.startsWith("data:image")):[],Ze=u.querySelector(".xgTWV_ga");if(!Ze)throw new Error("未找到评论按钮");let ho=[];Ze&&Ze.textContent.replace(/[^\d]+/g,"");const yt=u.querySelector(".AjnzIIcY"),go=yt?yt.textContent.trim():"",po=u.querySelector(".HBp3n39I"),vo=V.getElementTextToNumber(po,!1),wt=u.querySelector(".iVp55Gc1"),yo=wt?wt.textContent.trim():"";B={shopName:go,score:vo,sales:yo,title:x,seller:N,price:b,guarantee:Xe,banners:fo,params:pt,imgs:mo,comments:ho}}const f=document.querySelector(".transition-mask-appear-done .xRcNm_F4");f?f.click():Q.click()}const j=E.querySelector(".pMq55q1M>span , .M7M0nmSI.aKy92uTH.Y7dISI5p"),re=j?j.innerText.trim():"";console.log("提取到点赞数:",re);const ee=E.querySelector(".FnM1bbIQ , .xgplayer-time .time-duration"),X=ee?ee.innerText.trim():"";if(console.log("提取到时长:",X),!X)continue;const ne=E.querySelector(".WldPmwm5 , .j5WZzJdp"),ve=ne?ne.innerText.trim():"";console.log("提取到作者:",ve);const Z=E.querySelector(".dO8W7uoF"),ye=Z?Z.innerText.trim().replace(/^[·\s]+/,""):"";console.log("提取到发布时间:",ye),O.push({title:G,cover:k,author:ve,authorID:"",authorLink:"",authorAvatar:"",link:y,likes:re,isTop:!1,duration:X,publishTime:ye,product:B}),h.add(y),console.log(`成功添加第 ${S+1} 项视频数据 (总计 ${m.length+O.length}/${a})`),V.sendMessage(`已抓取 ${m.length+O.length}/${a} 个视频，继续抓取中...`)}const L=[...m,...O];return console.log(`当前已抓取 ${L.length} 个视频数据`),L.length>=a?(V.sendMessage(`已抓取 ${a} 个视频数据`),L.slice(0,a)):O.length===0&&(w++,w>=p)?(console.log(`已尝试滚动 ${w} 次但没有找到新视频，停止抓取`),V.sendMessage(`已抓取 ${L.length} 个视频数据`),L):(await new Promise(S=>setTimeout(S,500)),await n(),await this.scrapeGeneral(a,L,w,p))}async scrapeVideos(a=100,m=[],w=0,p=10){var _;let $=!1;const A=document.querySelectorAll(`${this.videoListContainerSelector}>div:last-child`);for(const T of A)if(V.getTextNodeValue(T).includes("暂时没有更多了")){console.log('检测到"暂时没有更多了"提示，已到达页面底部'),$=!0;break}if($&&m.length>0)return console.log("已抓取到底部，返回当前结果"),m;let v=[];this.videoListContainer&&(v=Array.from(V.querySelectorAll(this.videoListContainer,["li.SwZLHMKk.SEbmeLLH","li>div.search-result-card"])||[]),console.log(`从容器中找到 ${v.length} 个视频项`)),v.length===0&&(console.log("在容器中未找到视频项，尝试在全页面中查找..."),v=Array.from(V.querySelectorAll(document,["li.SwZLHMKk.SEbmeLLH","li>div.search-result-card"])||[]),console.log(`在全页面中找到 ${v.length} 个视频项`));function P(T,S=5){const E=[];let q=T,y=0;for(;q&&y<S;){const U=q.className?` (class="${q.className}")`:"",k=q.id?` (id="${q.id}")`:"";E.push(`${q.tagName.toLowerCase()}${U}${k}`),q=q.parentElement,y++}return E}if(v.length===0){console.log("未找到视频项，输出页面结构以辅助调试:");const T=document.querySelectorAll('a[href*="/video/"]');console.log("包含/video/字符串的链接数量:",T.length),T.length>0&&(console.log("第一个视频链接:",T[0]),console.log("包含该链接的父元素链:",P(T[0])));const S=document.querySelectorAll("li");console.log("页面上的列表项数量:",S.length),console.log("页面上前5个列表项的类名:");for(let E=0;E<Math.min(5,S.length);E++)if(console.log(`列表项 ${E+1} 类名:`,S[E].className),S[E].querySelector('a[href*="/video/"]')){console.log(`列表项 ${E+1} 包含视频链接`),v=[S[E]];break}}const O=[],h=new Set(m.map(T=>T.link));for(let T=0;T<v.length;T++){const S=v[T];console.log(`处理第 ${T+1}/${v.length} 个视频数据 (总计 ${m.length+O.length}/${a})`);const E=S.querySelector('a[href*="/video/"]');let q="";if(E&&E.href){if(q=E.href,q.startsWith("//")&&(q="https:"+q),h.has(q)){console.log("跳过重复视频:",q);continue}console.log("提取到链接:",q)}else{console.log("未找到链接元素，跳过此项");continue}if((_=S.querySelector(".semi-tag-content.semi-tag-content-ellipsis"))!=null&&_.textContent.includes("直播中")){console.log("跳过直播视频，index:",T);continue}const y=S.querySelector('.FWkvEMo5, img[src*="douyinpic"]');let U="";if(y){if(y.style&&y.style.backgroundImage){const Z=y.style.backgroundImage.match(/url\(['"]?(.*?)['"]?\)/);Z&&Z[1]&&(U=Z[1])}else y.src&&(U=y.src);console.log("提取到封面图:",U)}else console.log("未找到封面图元素");const k=S.querySelector(".VDYK8Xd7"),D=k?k.innerText.trim():"";if(console.log("提取到标题:",D),!D)continue;const G=S.querySelector(".cIiU4Muu"),B=G?G.innerText.trim():"";console.log("提取到点赞数:",B);const Q=S.querySelector(".ckopQfVu"),j=Q?Q.innerText.trim():"";console.log("提取到时长:",j);const re=S.querySelector(".MZNczJmS"),ee=re?re.innerText.trim():"";console.log("提取到作者:",ee);const X=S.querySelector(".faDtinfi"),ne=X?X.innerText.trim().replace(/^[·\s]+/,""):"";console.log("提取到发布时间:",ne),O.push({title:D,cover:U,author:ee,authorID:"",authorLink:"",authorAvatar:"",link:q,likes:B,isTop:!1,duration:j,publishTime:ne}),h.add(q),console.log(`成功添加第 ${T+1} 项视频数据 (总计 ${m.length+O.length}/${a})`),V.sendMessage(`已抓取 ${m.length+O.length}/${a} 个视频，继续抓取中...`)}const L=[...m,...O];if(console.log(`当前已抓取 ${L.length} 个视频数据`),L.length>=a){const T=L.slice(0,a);return V.sendMessage(`已抓取 ${T.length} 个视频数据`),T}return O.length===0&&(w++,w>=p)?(console.log(`已尝试滚动 ${w} 次但没有找到新视频，停止抓取`),V.sendMessage(`已抓取 ${L.length} 个视频数据`),L):(await new Promise(T=>setTimeout(T,500)),await n(),await this.scrapeVideos(a,L,w,p))}}async function n(){return new Promise(d=>{console.log("滚动加载更多视频..."),V.sendMessage("正在滚动加载更多视频...");const a=document.querySelector(`.parent-route-container.route-scroll-container
        , .parent-route-container.bX97FWk8.route-scroll-container.h5AVrOfS
        , .child-route-container.route-scroll-container`);if(!a){console.log("未找到滚动容器，使用window滚动到页面底部"),window.scrollTo(0,document.body.scrollHeight),setTimeout(d,1500);return}console.log("找到滚动容器:",a);const m=a.scrollTop,w=a.scrollHeight,p=a.clientHeight;console.log(`滚动容器信息 - 当前位置: ${m}, 容器高度: ${p}, 总高度: ${w}`);const $=10,A=1e3/$,v=50;let P=0;const O=setInterval(()=>{if(P>=$){clearInterval(O),setTimeout(()=>{console.log("等待新视频加载完成..."),V.sendMessage("正在等待新视频加载..."),d("")},1500);return}P++,a.scrollTop=m+A*P,console.log(`滚动步骤 ${P}/${$}, 当前位置: ${a.scrollTop}`)},v)})}const r=(await ze()).douyin.maxSearchListCount.value,c=await new s(o).getData(r);return console.log(`共抓取到 ${c==null?void 0:c.length} 个视频数据`),{searchList:c}}async function no(){console.log("开始抓取抖音用户页面数据..."),console.log("提取用户基本信息...");const e=(await ze()).douyin.maxUserVideoCount.value;let o="";const s=document.querySelector('div[data-e2e="user-detail"]');if(s){const y=s.querySelector("img");y&&y.src&&(o=y.src,console.log("从user-detail中提取到用户头像:",o))}if(!o){const y=document.querySelector('span[data-e2e="live-avatar"] img, .ZgMmtbts img, .vBNjZx2k img, .RlLOO79h');y&&y.src&&(o=y.src,console.log("从其他选择器提取到用户头像:",o))}const n=V.querySelector(document,['div[data-e2e="user-info"], .mZmVWLzR']);if(!n)return console.log("未找到用户信息容器"),{userId:"",username:"",avatar:"",description:"",age:"",gender:"",constellation:"",location:"",ipLocation:"",following:"",followers:"",likes:"",postCount:"",verified:"",videos:[]};const i=V.querySelector(n,["h1 span span"]),r=i?i.textContent.trim():"";console.log("用户昵称:",r);let l="";const c=document.querySelector('span[data-e2e="badge-role-name"]');if(c&&(l=c.textContent.trim(),console.log("从badge-role-name提取到认证信息:",l)),!l){const y=document.querySelector(".RgbYc1wS, .Rbnl7KnE");y&&(l=y.textContent.trim(),console.log("从RgbYc1wS或Rbnl7KnE提取到认证信息:",l))}if(!l){const y=['svg[fill="#FFDF3F"] + span',".iCzbLgz8",".QvpE-l1F",".rZnY2xpc span"];for(const U of y)try{const k=document.querySelector(U);if(k&&k.textContent&&k.textContent.trim()!==""){l=k.textContent.trim(),console.log(`从选择器 ${U} 提取到认证信息:`,l);break}}catch(k){console.error(`选择器 ${U} 提取出错:`,k)}}const d=V.querySelectorWithText(n,["span"],"抖音号：");let a="";if(d){const y=d.textContent.trim();y.startsWith("抖音号：")&&(a=y.replace("抖音号：","")),console.log("用户ID:",a)}const m=V.querySelectorWithText(n,["span"],"IP属地："),w=m?m.textContent.trim().replace("IP属地：",""):"";console.log("IP属地:",w);let p="",$="";const A=V.querySelector(n,["span.NTpV9gKg","p span:nth-child(2)"]);if(A){const y=A.querySelector('svg[stroke="#F5588E"]'),U=A.querySelector('g[stroke="#F5588E"]'),k=A.querySelector('svg[stroke="#57BDFC"]'),D=A.querySelector('g[stroke="#57BDFC"]'),G=A.querySelector('path[fill="#168EF9"]'),B=A.textContent.trim();y||U||B.includes("女")?(p="female",console.log("性别: 女")):(k||D||G||B.includes("男"))&&(p="male",console.log("性别: 男"));const Q=A.querySelector("span");if(Q){const j=Q.innerText.match(/(\d+)/);j&&j[1]&&($=j[1],console.log("年龄:",$))}}let v="";try{const y=document.querySelectorAll("script");for(const U of y)if(U.textContent&&U.textContent.includes('"desc":')){const k=U.textContent,D=/"desc":"([^"]*)"/.exec(k);if(D&&D[1]){v=D[1].replace(/\\n/g,`
`),console.log("从脚本中提取到完整bio:",v);break}}}catch(y){console.error("从脚本提取bio出错:",y)}if(!v){const y=n.querySelector("div.DtlymgqL span span span span span span");if(y&&(v=y.textContent.trim(),console.log("从DtlymgqL元素提取到bio:",v)),!v||v===""){const U=document.querySelector("div.X45g5WK0 span span span span span span");U&&(v=U.textContent.trim(),console.log("从X45g5WK0元素提取到bio:",v))}if(!v||v===""){const U=[".X45g5WK0 span",".j5WZzJdp span",".X45g5WK0 .j5WZzJdp",".user-bio",".user-desc",'[data-e2e="user-bio"]','[data-e2e="user-desc"]'];for(const k of U){const D=document.querySelector(k);if(D&&D.textContent&&D.textContent.trim()!==""){v=D.textContent.trim(),console.log(`从选择器 ${k} 提取到bio:`,v);break}}}}console.log("最终提取到的bio:",v);const P=V.querySelectorAll(n,['div[data-e2e="user-info-follow"] div:last-child, div[data-e2e="user-info-fans"] div:last-child, div[data-e2e="user-info-like"] div:last-child']);let O="",h="",L="";P&&P.length>=3&&(O=P[0].textContent.trim(),h=P[1].textContent.trim(),L=P[2].textContent.trim()),console.log("关注数:",O),console.log("粉丝数:",h),console.log("获赞数:",L);const _=document.querySelector('#semiTabpost [data-e2e="user-tab-count"]');let T=_?_.textContent.trim():"";console.log("作品数量:",T);let S=0;if(T)if(T.includes("万")){const y=parseFloat(T.replace(/[^0-9.]/g,""));isNaN(y)||(S=y*1e4)}else S=parseInt(T.replace(/[^0-9]/g,""))||0;console.log("作品数量(数字):",S);const E=Math.min(S,e);console.log(`将抓取最多 ${E} 个视频`);const q=await io(E);return console.log(`成功抓取 ${q.length} 个视频`),{userId:a,username:r,avatar:o,description:v,age:$,gender:p,constellation:"",location:w,ipLocation:"",following:O,followers:h,likes:L,postCount:T,verified:l,videos:q}}async function io(t=100){console.log(`开始抓取用户视频，最多 ${t} 个...`);let e=null;const o=document.querySelector('div[data-e2e="user-post-list"]');if(o){const i=o.querySelector('ul[data-e2e="scroll-list"]');i&&(e=i,console.log('找到data-e2e="scroll-list"容器'))}if(e||(e=document.querySelector(".OCcpRRtX"),e&&console.log("找到.OCcpRRtX容器")),!e){const i=['ul[data-e2e="scroll-list"]','div[data-e2e="user-post-list-item"]','ul[data-e2e="user-post-list"]',".DmhHcNHN",'div[data-e2e="user-post"]'];for(const r of i){const l=document.querySelector(r);if(l){console.log(`找到容器，使用选择器: ${r}`),e=l;break}}}async function s(i=[],r=0,l=20){V.sendMessage(`已抓取 ${i.length}/${t} 个视频，继续抓取中...`);let c;e?(c=e.querySelectorAll("li"),console.log(`从容器中找到 ${c.length} 个视频项`)):(c=document.querySelectorAll('div[data-e2e="user-post-item"], .TikR9yWD, .niBfRBgX'),console.log(`直接找到 ${c.length} 个视频项`));const d=[],a=new Set(i.map(w=>w.link));for(let w=0;w<c.length;w++){const p=c[w];console.log(`处理第 ${w+1}/${c.length} 个视频数据 (总计 ${i.length+d.length}/${t})`);const $=p.querySelector("a");let A="";if($&&$.href){if(A=$.href,a.has(A)){console.log("跳过重复视频:",A);continue}console.log("视频链接:",A)}else{console.log("未找到链接元素，跳过此项");continue}const v=p.querySelector("img");let P="";v&&v.src&&(P=v.src,console.log("视频封面:",P));let O="";const h=[".ztA3qIFr",".Ja95nb2Z",".iQKjh6vV","p.VdTyguLN","div>a>p"];for(const k of h){const D=p.querySelector(k);if(D&&D.innerText.trim()){O=D.innerText.trim(),console.log(`从选择器 ${k} 提取到视频标题:`,O);break}}const L=p.querySelector(".b3Dh2ia8, .DxWBwQZu, .author-card-user-video-like>span:last-child");let _="";L&&(_=L.innerText.trim(),console.log("视频点赞数:",_));const T=p.querySelector(".ckopQfVu, .video-duration, ._L26I_xb");let S="";T&&(S=T.innerText.trim(),console.log("视频时长:",S));let E="";const q=[".faDtinfi",".VFUqD35C",".video-date",".publish-time"];for(const k of q){const D=p.querySelector(k);if(D&&D.innerText.trim()){E=D.innerText.trim().replace(/^[·\s]+/,""),console.log(`从选择器 ${k} 提取到发布时间:`,E);break}}const y=p.querySelector(".semi-tag-content-ellipsis, .user-video-tag"),U=y&&y.innerText.includes("置顶");if(U&&console.log("这是置顶视频"),d.push({title:O,cover:P,author:"",authorID:"",authorLink:"",authorAvatar:"",link:A,likes:_,isTop:U||!1,duration:S,publishTime:E}),a.add(A),V.sendMessage(`已抓取 ${i.length+d.length}/${t} 个视频，继续抓取中...`),i.length+d.length>=t){console.log(`已达到最大视频数 ${t}，停止处理`);break}}const m=[...i,...d];return console.log(`当前已抓取 ${m.length} 个视频数据`),m.length>=t?m.slice(0,t):d.length===0&&(r++,r>=l)?(console.log(`已尝试滚动 ${r} 次但没有找到新视频，停止抓取`),m):(await new Promise(w=>setTimeout(w,300)),await n(),s(m,r,l))}async function n(){return new Promise(i=>{console.log("滚动加载更多视频..."),V.sendMessage("正在滚动加载更多视频...");const r=document.querySelector(".parent-route-container.route-scroll-container, .parent-route-container.bX97FWk8.route-scroll-container.h5AVrOfS");if(!r){console.log("未找到滚动容器，使用window滚动到页面底部"),window.scrollTo(0,document.body.scrollHeight),setTimeout(i,1500);return}console.log("找到滚动容器:",r);const l=r.scrollTop,c=r.scrollHeight,d=r.clientHeight;console.log(`滚动容器信息 - 当前位置: ${l}, 容器高度: ${d}, 总高度: ${c}`);const a=10,m=1e3/a,w=50;let p=0;const $=setInterval(()=>{if(p>=a){clearInterval($),setTimeout(()=>{console.log("等待新视频加载完成..."),V.sendMessage("正在等待新视频加载..."),i("")},1500);return}p++,r.scrollTop=l+m*p,console.log(`滚动步骤 ${p}/${a}, 当前位置: ${r.scrollTop}`)},w)})}try{const i=await s([],0,20),r=document.querySelector('div[data-e2e="user-info"], .mZmVWLzR');let l="",c="";if(r){const m=r.querySelector("h1 span span");l=m?m.innerText.trim():"";const w=V.querySelectorWithText(r,["span"],"抖音号：");if(w){const p=w.innerText.trim();p.startsWith("抖音号：")&&(c=p.replace("抖音号：",""))}}let d="";const a=document.querySelector('div[data-e2e="user-detail"]');if(a){const m=a.querySelector("img");m&&m.src&&(d=m.src,console.log("从user-detail中提取到用户头像:",d))}return V.sendMessage(`已完成抓取 ${i.length} 个视频数据`),i.map(m=>({...m,author:l,authorID:c,authorAvatar:d||m.authorAvatar||""}))}catch(i){return console.error("抓取视频时出错:",i),[]}}const so={matches:["*://*.douyin.com/*"],main:t=>{console.log("Hello douyin content.");const e=window.location.href;e.includes("modal_id=")||e.match(/(\/video\/\d+$)|(\/video\/\d+[?|\/])/),Tt(ro)}};async function ro(t,e){let o,s="unsupported";console.log("当前域名:",t),console.log("当前URL:",e),e.includes("modal_id=")||e.match(/(\/video\/\d+$)|(\/video\/\d+[?|\/])/)?(console.log("检测到抖音视频详情页面，开始抓取视频详情数据"),o=await to(),s="video"):e.includes("/search/")&&(e.includes("type=general")||e.includes("type=video"))?(console.log("检测到抖音视频搜索页面，开始抓取视频搜索数据"),o=await oo(),s="search"):e.includes("/user/")?(console.log("检测到抖音用户详情页面，开始抓取用户详情数据"),o=await no(),s="user"):console.log("不是支持的抖音页面类型，抓取跳过");const n=new Date().toLocaleString(),i={domain:t,type:s,data:o,fetchTime:n};return console.log("抓取结果:",i),i}function $e(t,...e){}const lo={debug:(...t)=>$e(console.debug,...t),log:(...t)=>$e(console.log,...t),warn:(...t)=>$e(console.warn,...t),error:(...t)=>$e(console.error,...t)},Le=class Le extends Event{constructor(e,o){super(Le.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=o}};R(Le,"EVENT_NAME",Ye("wxt:locationchange"));let Qe=Le;function Ye(t){var e;return`${(e=F==null?void 0:F.runtime)==null?void 0:e.id}:douyin:${t}`}function co(t){let e,o;return{run(){e==null&&(o=new URL(location.href),e=t.setInterval(()=>{let s=new URL(location.href);s.href!==o.href&&(window.dispatchEvent(new Qe(s,o)),o=s)},1e3))}}}const pe=class pe{constructor(e,o){R(this,"isTopFrame",window.self===window.top);R(this,"abortController");R(this,"locationWatcher",co(this));R(this,"receivedMessageIds",new Set);this.contentScriptName=e,this.options=o,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return F.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,o){const s=setInterval(()=>{this.isValid&&e()},o);return this.onInvalidated(()=>clearInterval(s)),s}setTimeout(e,o){const s=setTimeout(()=>{this.isValid&&e()},o);return this.onInvalidated(()=>clearTimeout(s)),s}requestAnimationFrame(e){const o=requestAnimationFrame((...s)=>{this.isValid&&e(...s)});return this.onInvalidated(()=>cancelAnimationFrame(o)),o}requestIdleCallback(e,o){const s=requestIdleCallback((...n)=>{this.signal.aborted||e(...n)},o);return this.onInvalidated(()=>cancelIdleCallback(s)),s}addEventListener(e,o,s,n){var i;o==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(i=e.addEventListener)==null||i.call(e,o.startsWith("wxt:")?Ye(o):o,s,{...n,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),lo.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:pe.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(e){var i,r,l;const o=((i=e.data)==null?void 0:i.type)===pe.SCRIPT_STARTED_MESSAGE_TYPE,s=((r=e.data)==null?void 0:r.contentScriptName)===this.contentScriptName,n=!this.receivedMessageIds.has((l=e.data)==null?void 0:l.messageId);return o&&s&&n}listenForNewerScripts(e){let o=!0;const s=n=>{if(this.verifyScriptStartedEvent(n)){this.receivedMessageIds.add(n.data.messageId);const i=o;if(o=!1,i&&(e!=null&&e.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",s),this.onInvalidated(()=>removeEventListener("message",s))}};R(pe,"SCRIPT_STARTED_MESSAGE_TYPE",Ye("wxt:content-script-started"));let Ge=pe;function So(){}function qe(t,...e){}const ao={debug:(...t)=>qe(console.debug,...t),log:(...t)=>qe(console.log,...t),warn:(...t)=>qe(console.warn,...t),error:(...t)=>qe(console.error,...t)};return(async()=>{try{const{main:t,...e}=so,o=new Ge("douyin",e);return await t(o)}catch(t){throw ao.error('The content script "douyin" crashed on startup!',t),t}})()}();
douyin;
