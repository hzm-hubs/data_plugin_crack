var xiaohongshu=function(){"use strict";var Ot=Object.defineProperty;var Vt=(j,D,A)=>D in j?Ot(j,D,{enumerable:!0,configurable:!0,writable:!0,value:A}):j[D]=A;var b=(j,D,A)=>Vt(j,typeof D!="symbol"?D+"":D,A);var Ye,Ge;function j(t){return t}const A=(Ge=(Ye=globalThis.browser)==null?void 0:Ye.runtime)!=null&&Ge.id?globalThis.browser:globalThis.chrome,te={"sycm.taobao":{name:"生意参谋",domain:"sycm.taobao",fullDomain:"sycm.taobao.com"},"one.alimama":{name:"阿里妈妈万象台",domain:"one.alimama",fullDomain:"one.alimama.com"},taobao:{name:"淘宝",domain:"taobao",fullDomain:"taobao.com"},tmall:{name:"天猫",domain:"tmall",fullDomain:"tmall.com"},tmallhk:{name:"天猫国际",domain:"tmallhk",fullDomain:"tmall.hk"},douyin:{name:"抖音",domain:"douyin",fullDomain:"douyin.com"},xiaohongshu:{name:"小红书",domain:"xiaohongshu",fullDomain:"xiaohongshu.com"},jd:{name:"京东",domain:"jd",fullDomain:"jd.com"},tiktok:{name:"tiktok",domain:"tiktok",fullDomain:"tiktok.com"},youtube:{name:"youtube",domain:"youtube",fullDomain:"youtube.com"},other:{name:"其他",domain:"other",fullDomain:"other"}};function Qe(t){console.log("getDomain",t),t||(t=window.location.href);for(let e in te)if(t.includes(te[e].fullDomain))return te[e].domain;return te.other.domain}function ze(t,e="data_"){return t&&t.indexOf("https://sycm.taobao.com/cc/customer/trip")===0?t="https://sycm.taobao.com/cc/customer/trip":t&&t.indexOf("https://sycm.taobao.com/cc/customer/overview")===0?t="https://sycm.taobao.com/cc/customer/overview":t&&t.indexOf("https://one.alimama.com/index.html#!/manage/onesite")===0&&(t="https://one.alimama.com/index.html#!/manage/onesite"),e+btoa(t)}function $e(t,e=5e3){return new Promise((o,r)=>{console.log(`等待元素加载: ${t}, 超时: ${e}ms`);const n=document.querySelector(t);if(n)return o(n);const s=setTimeout(()=>{if(l){l.disconnect(),console.log(`等待元素超时: ${t}`);const i=document.querySelector(t);i?o(i):r(new Error(`等待元素超时: ${t}`))}},e),l=new MutationObserver((i,c)=>{const d=document.querySelector(t);d&&(clearTimeout(s),c.disconnect(),o(d))});l.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","data-e2e"]}),console.log("MutationObserver已启动")})}class Ze{constructor(){b(this,"sleep",e=>new Promise(o=>setTimeout(o,e)));b(this,"runDelay",async(e,o)=>new Promise(r=>setTimeout(()=>{r(e())},o)));b(this,"sendMessage",e=>{A.runtime.sendMessage({action:"updateStatus",status:e})});b(this,"sendDataWithAction",(e,o)=>{A.runtime.sendMessage({action:o,data:e})});b(this,"openPopup",(e=-1)=>{A.runtime.sendMessage({action:"openPopup",windowId:e})});b(this,"openSidePanel",(e=-1)=>{A.runtime.sendMessage({action:"openSidePanel",windowId:e})});b(this,"elementHover",(e,o=!0)=>{e.dispatchEvent(new MouseEvent(o?"mouseover":"mouseout",{bubbles:!0}))});b(this,"setElementAnimation",e=>{const o="266A247A-6C68-4F89-8D11-B767B4E7A71C",r="animation_"+o.slice(0,8),n="class_"+o.slice(0,8);if(!document.head.querySelector(`style[data-id='${o}']`)){const s=document.createElement("style");s.type="text/css",s.setAttribute("data-id",o);const l=`
      @keyframes ${r}{
        to {  background-color :rgb(255, 0, 0);
              border: 1px solid blue;
              border-radius: 3px;
        }
      }
    `,i=`
      .${n} {
        animation: ${r} 0.5s ease-in-out 0s 2 alternate none;
      }
    `;s.innerHTML=l+i,document.head.appendChild(s)}return e.classList.remove(n),e.offsetHeight,e.classList.add(n),e});b(this,"waitForChildListChange",async(e,o,r=5e3)=>new Promise((n,s)=>{const l=setTimeout(()=>{i&&(i.disconnect(),console.log("等待元素更新超时: ",o,`超时时间：${r}ms`),n(!1))},r),i=new MutationObserver((c,d)=>{if(c.length>0)for(const m of c)if(m.type==="attributes")m.attributeName;else if(m.type==="childList"){clearTimeout(l),d.disconnect(),n(!0);return}else m.type});i.observe(o,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0}),e&&e()}));b(this,"waitForElementTextChange",async(e,o,r=5e3)=>new Promise((n,s)=>{console.log("等待元素更新:",o,` 超时: ${r}ms`);const l=setTimeout(()=>{i&&(i.disconnect(),console.log("等待元素更新超时: ",o,`超时时间：${r}ms`),n(!1))},r),i=new MutationObserver((c,d)=>{if(c.length>0){for(const m of c)if(m.type==="attributes")m.attributeName;else if(m.type!=="childList"){if(m.type==="characterData"){clearTimeout(l),d.disconnect(),n(!0);return}}}});i.observe(o,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0}),e&&e()}));b(this,"waitForElementAttrChange",async(e,o,r=5e3)=>new Promise((n,s)=>{console.log("等待元素属性更新:",o,` 超时: ${r}ms`);const l=setTimeout(()=>{i&&(i.disconnect(),console.log("等待元素属性更新超时: ",o,`超时时间：${r}ms`),n(!1))},r),i=new MutationObserver((c,d)=>{if(c.length>0)for(const m of c)if(m.type==="attributes"){m.attributeName,clearTimeout(l),d.disconnect(),n(!0);return}else m.type==="childList"||m.type});i.observe(o,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0}),e&&e()}));b(this,"waitForElementListTextChange",async(e,o,r=5e3,n=!0)=>{let s=[];return new Promise((l,i)=>{o.forEach(c=>{this.waitForElementTextChange(()=>{},c,r).then(async d=>{s.push({target:c,result:d}),n?s.length===o.length&&l(s):s.length==1&&(await this.sleep(500),l(s))})}),e&&e()})});b(this,"waitForElementListAttrChange",async(e,o,r=5e3,n=!0)=>{let s=[];return new Promise((l,i)=>{o.forEach(c=>{this.waitForElementAttrChange(()=>{},c,r).then(async d=>{s.push({target:c,result:d}),n?s.length===o.length&&l(s):s.length==1&&(await this.sleep(500),l(s))})}),e&&e()})});b(this,"waitForElementRemove",async(e,o=5e3)=>new Promise((r,n)=>{const l=o/10;let i=0;const c=setInterval(()=>{if(!document.querySelector(e)){clearInterval(c),r(!0);return}i++,i<l?console.log("等待元素移除:",e,` 超时: ${o}ms`,`剩余时间：${o-i*10}ms`):(console.log("等待元素移除超时: ",e,`超时时间：${o}ms`),clearInterval(c),n(!1))},10)}));b(this,"scrollToElementTop",e=>{e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})});b(this,"scrollToElement",e=>{e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})});b(this,"scrollToElementBottom",e=>{e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})});b(this,"ensureElementVisible",e=>{let o=e;for(;o&&o!==document.body;){const i=o.parentElement;if(!i)break;const c=i.scrollHeight>i.clientHeight,d=i.scrollWidth>i.clientWidth;if(c||d){const m=i.getBoundingClientRect(),f=o.getBoundingClientRect();c&&(f.top<m.top?i.scrollTop-=m.top-f.top:f.bottom>m.bottom&&(i.scrollTop+=f.bottom-m.bottom)),d&&(f.left<m.left?i.scrollLeft-=m.left-f.left:f.right>m.right&&(i.scrollLeft+=f.right-m.right))}o=i}const r=window.scrollY,n=r+window.innerHeight,s=e.offsetTop,l=s+e.offsetHeight;s<r?window.scrollTo({top:s,behavior:"smooth"}):l>n&&window.scrollTo({top:l-window.innerHeight,behavior:"smooth"})});b(this,"getTextNodeValue",(e,o=!1)=>{this.setElementAnimation(e);const r=Array.from(e.childNodes).filter(n=>n.nodeType===Node.TEXT_NODE).map(n=>n.textContent).join("");return o?+r.replace(/[^\d-.]/g,""):r});b(this,"getElementText",(e,o=!0)=>e?(o&&this.setElementAnimation(e),e.textContent):"");b(this,"getElementTextToNumber",(e,o=!0)=>{if(e){const r=this.getElementText(e,o).replace(/[^\d-.]/g,"");return r&&!isNaN(r)?+r:r}return 0});b(this,"getUserInputNumber",async(e=10,o="请输入最大数据条数，默认10条，最小1条，最大100条",r=100)=>{let n=await this.showInput(o,e,r);for(;n;){let s=0;if(!isNaN(n)&&(s=parseInt(n),s>0&&s<=r)){e=s;break}n=await this.showInput(o,e,r)}return e});b(this,"waitElementInViewportUseObserver",async(e,o=5e3)=>new Promise((r,n)=>{this.isElementInViewport(e)&&r(!0),setTimeout(()=>{r(!1),s.disconnect()},o);const s=new IntersectionObserver(l=>{l.forEach(async i=>{i.isIntersecting&&(r(!0),s.disconnect())})});if(!e)return n("元素不存在");this.scrollToElement(e),s.observe(e)}));b(this,"waitElementInViewportUseClientRect",async(e,o=!1,r=5e3)=>{new Promise(async(n,s)=>{if(!e||typeof e.getBoundingClientRect!="function")return n(!1);let l=null;const i=()=>{const f=e.getBoundingClientRect(),x=window.innerHeight||document.documentElement.clientHeight,q=window.innerWidth||document.documentElement.clientWidth;let R=!1;if(o)R=f.top>=0&&f.bottom<=x&&f.left>=0&&f.right<=q;else{const p=f.top<=x&&f.bottom>=0,S=f.left<=q&&f.right>=0;R=p&&S}R&&(l&&clearInterval(l),n(!0))},c=10,d=parseInt(r/c+"")>0?parseInt(r/c+""):1;let m=0;l=setInterval(()=>{m++,m>d?(l&&clearInterval(l),n(!1)):i()},c)})});b(this,"isElementInViewport",e=>{const o=e.getBoundingClientRect(),r=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth;return o.top<r&&o.bottom>0&&o.left<n&&o.right>0});b(this,"getItemTextAndLog",(e,o,r,n="")=>{const s=this.querySelector(e,o);let l=this.getElementText(s);return n&&(l=(s==null?void 0:s.getAttribute(n))||""),r&&!s&&console.log(r),l});b(this,"waitForResult",async(e,o=5e3)=>{const r=Math.floor(o/100);for(let n=0;n<r;n++){if(await e())return!0;await this.sleep(100)}return!1});b(this,"getNumberText",e=>{const o=e.match(/[\.\d]+(千万)?(万亿)?[万|亿|k|K|m|M|b|B]?/);return o?o[0]:e})}deepScroll(e){return new Promise((o,r)=>{const n=[],s={element:e.element||window,duration:e.duration||500,easing:e.easing||"easeInOutQuad",scrollContainers:n,left:e.left,top:e.top,target:e.target,callback:e.callback};function l(a){const w=[];let g=a;for(;g&&g!==document.documentElement;)i(g)&&w.push(g),g=g.parentElement;return c()&&w.push(window),w}function i(a){if(a===window||!(a instanceof HTMLElement))return!0;const w=getComputedStyle(a),g=w.overflowY==="auto"||w.overflowY==="scroll",v=w.overflowX==="auto"||w.overflowX==="scroll";return g&&a.scrollHeight>a.clientHeight||v&&a.scrollWidth>a.clientWidth}function c(){return document.documentElement.scrollHeight>window.innerHeight}function d(a,w){const g=w.getBoundingClientRect();if(a instanceof Window)return{top:m(g.top-window.pageYOffset+window.outerHeight,g.height,window.innerHeight,window.outerHeight),left:m(g.left-window.pageXOffset+window.outerWidth,g.width,window.innerWidth,window.outerWidth)};const v=a.getBoundingClientRect();return{top:m(g.top-v.top+a.scrollTop,g.height,a.clientHeight,a.scrollTop),left:m(g.left-v.left+a.scrollLeft,g.width,a.clientWidth,a.scrollLeft)}}function m(a,w,g,v){const u=v,h=v+g,C=a+w;return a>=u&&C<=h?v:a<u?a:C-g}function f(a){return a instanceof Window?window.pageYOffset:a.scrollTop}function x(a){return a instanceof Window?window.pageXOffset:a.scrollLeft}function q(a,w,g){a instanceof Window?window.scrollTo(g,w):(a.scrollTop=w,a.scrollLeft=g)}if(s.target){const a=l(s.target);let w=s.target;a.forEach(g=>{const v=d(g,w);s.scrollContainers.push({element:g,startTop:f(g),targetTop:v.top,startLeft:x(g),targetLeft:v.left}),w=g})}else s.scrollContainers.push({element:s.element,startTop:f(s.element),targetTop:s.top??f(s.element),startLeft:x(s.element),targetLeft:s.left??x(s.element)});const R={linear:a=>a,easeInQuad:a=>a*a,easeOutQuad:a=>a*(2-a),easeInOutQuad:a=>a<.5?2*a*a:-1+(4-2*a)*a},p=R[s.easing]||R.easeInOutQuad;let S=0;const I=()=>{var a;o(""),s.target,(a=s.callback)==null||a.call(s)},_=a=>{S||(S=a);const w=a-S,g=Math.min(w/s.duration,1),v=p(g);s.scrollContainers.forEach(({element:u,startTop:h,targetTop:C,startLeft:y,targetLeft:E})=>{const $=h+(C-h)*v,H=y+(E-y)*v;q(u,$,H)}),w<s.duration?requestAnimationFrame(_):I()};requestAnimationFrame(_)})}async showInput(e,o,r){return new Promise((n,s)=>{A.runtime.sendMessage({action:"showInput",placeholder:e,defaultValue:o,max:r},l=>{n(l.value)})})}simpleUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const o=Math.random()*16|0;return(e==="x"?o:o&3|8).toString(16)})}formatDateTime(e,o=!1){if(typeof e=="string")e=new Date(e);else if(typeof e=="number")e=new Date(e);else if(!(e instanceof Date))return"";if(isNaN(e))return"";const r={year:e.getFullYear(),mounth:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),ms:e.getMilliseconds()},n=(l,i=2)=>(l+"").padStart(i,"0");let s=`${r.year}-${n(r.mounth)}-${n(r.day)} ${n(r.hour)}:${n(r.minute)}:${n(r.second)}`;return o&&(s+=`:${r.ms}`),s}formatDate(e){const o=this.formatDateTime(e);return o?o.split(" ")[0]:""}parseChineseNumber(e){const o={万亿:1e12,千亿:1e11,百亿:1e10,十亿:1e9,亿:1e8,千万:1e7,百万:1e6,万:1e4,千:1e3,百:100,十:10,k:1e3,K:1e3,m:1e6,M:1e6,b:1e9,B:1e9,t:1e12,T:1e12};let r="";for(const d in o)r?r+="|"+d:r+=d;const n=String(e).match(new RegExp(`^(\\d+.?\\d*)([${r})]*)`));if(!n)return 0;const s=parseFloat(n[1]),l=n[2].trim(),i=Object.keys(o).find(d=>l.startsWith(d)),c=i?o[i]:1;return l==="千万"?s*1e7:s*c}querySelector(e,o=[]){let r=null;for(const n of o){const s=n.match(/(.+):contains\(['"](.+)['"]\)/);if(s){const l=s[1],i=s[2];if(r=e.querySelector(l),r&&r.textContent.includes(i))break}else if(r=e.querySelector(n),r)break}return r}querySelectorAll(e,o=[]){for(const r of o){const n=r.match(/(.+):contains\(['"](.+)['"]\)/);if(n){const s=n[1],l=n[2],i=e.querySelectorAll(s);if(i&&i.length>0)return Array.from(i).filter(d=>d.textContent.includes(l))}else{const s=e.querySelectorAll(r);if(s.length>0)return Array.from(s)}}return[]}querySelectorWithText(e,o=[],r=""){let n=null;for(const s of o)if(n=e.querySelectorAll(s),n.length>0){for(const l of n)if(l.textContent.includes(r))return l}return null}querySelectorAllWithText(e,o=[],r=""){let n=null;for(const s of o)if(n=e.querySelectorAll(s),n.length>0)return Array.from(n).filter(l=>l.textContent.includes(r));return[]}}const N=new Ze;function Je(t){A.runtime.onMessage.addListener((e,o,r)=>{if(e.action==="getData")return console.log("收到获取数据请求"),(async()=>{try{const n=await et(t);A.runtime.sendMessage({action:"dataReceived",data:n}),r({data:n})}catch(n){console.error("抓取数据时出错:",n),A.runtime.sendMessage({action:"dataError",error:n.message})}})(),r({action:"__default"}),!0})}async function et(t){const e=window.location.href,o=ze(e),r=Qe(e);try{const n=await t(r,e);return console.log(`抓取到${r}数据:`,n),n.type=="unsupported"&&N.sendMessage("前页面不支持数据抓取"),await A.storage.local.set({[o]:{domain:r,type:n.type,data:n.data,timestamp:new Date().getTime(),fetchTime:n.fetchTime,url:e}}),n}catch(n){throw console.error("抓取过程中发生错误:",n),n}}/**
* @vue/shared v3.5.18
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function tt(t){const e=Object.create(null);for(const o of t.split(","))e[o]=1;return o=>o in e}const ot=Object.assign,nt=Object.prototype.hasOwnProperty,me=(t,e)=>nt.call(t,e),U=Array.isArray,oe=t=>ke(t)==="[object Map]",rt=t=>typeof t=="string",X=t=>typeof t=="symbol",ne=t=>t!==null&&typeof t=="object",st=Object.prototype.toString,ke=t=>st.call(t),it=t=>ke(t).slice(8,-1),he=t=>rt(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,re=(t,e)=>!Object.is(t,e);/**
* @vue/reactivity v3.5.18
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let lt,De=0,ge;function pe(){De++}function we(){if(--De>0)return;let t;for(;ge;){let e=ge;for(ge=void 0;e;){const o=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){t||(t=r)}e=o}}if(t)throw t}let se=!0;const Ne=[];function at(){Ne.push(se),se=!1}function ct(){const t=Ne.pop();se=t===void 0?!0:t}class ut{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){}trigger(e){this.version++,this.notify(e)}notify(e){pe();try{for(let o=this.subs;o;o=o.prevSub)o.sub.notify()&&o.sub.dep.notify()}finally{we()}}}const ye=new WeakMap,O=Symbol(""),be=Symbol(""),Y=Symbol("");function L(t,e,o){if(se&&lt){let r=ye.get(t);r||ye.set(t,r=new Map);let n=r.get(o);n||(r.set(o,n=new ut),n.map=r,n.key=o),n.track()}}function P(t,e,o,r,n,s){const l=ye.get(t);if(!l)return;const i=c=>{c&&c.trigger()};if(pe(),e==="clear")l.forEach(i);else{const c=U(t),d=c&&he(o);if(c&&o==="length"){const m=Number(r);l.forEach((f,x)=>{(x==="length"||x===Y||!X(x)&&x>=m)&&i(f)})}else switch((o!==void 0||l.has(void 0))&&i(l.get(o)),d&&i(l.get(Y)),e){case"add":c?d&&i(l.get("length")):(i(l.get(O)),oe(t)&&i(l.get(be)));break;case"delete":c||(i(l.get(O)),oe(t)&&i(l.get(be)));break;case"set":oe(t)&&i(l.get(O));break}}we()}function K(t){const e=T(t);return e===t?e:(L(e,"iterate",Y),V(t)?e:e.map(M))}function xe(t){return L(t=T(t),"iterate",Y),t}const dt={__proto__:null,[Symbol.iterator](){return Se(this,Symbol.iterator,M)},concat(...t){return K(this).concat(...t.map(e=>U(e)?K(e):e))},entries(){return Se(this,"entries",t=>(t[1]=M(t[1]),t))},every(t,e){return k(this,"every",t,e,void 0,arguments)},filter(t,e){return k(this,"filter",t,e,o=>o.map(M),arguments)},find(t,e){return k(this,"find",t,e,M,arguments)},findIndex(t,e){return k(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return k(this,"findLast",t,e,M,arguments)},findLastIndex(t,e){return k(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return k(this,"forEach",t,e,void 0,arguments)},includes(...t){return ve(this,"includes",t)},indexOf(...t){return ve(this,"indexOf",t)},join(t){return K(this).join(t)},lastIndexOf(...t){return ve(this,"lastIndexOf",t)},map(t,e){return k(this,"map",t,e,void 0,arguments)},pop(){return G(this,"pop")},push(...t){return G(this,"push",t)},reduce(t,...e){return Pe(this,"reduce",t,e)},reduceRight(t,...e){return Pe(this,"reduceRight",t,e)},shift(){return G(this,"shift")},some(t,e){return k(this,"some",t,e,void 0,arguments)},splice(...t){return G(this,"splice",t)},toReversed(){return K(this).toReversed()},toSorted(t){return K(this).toSorted(t)},toSpliced(...t){return K(this).toSpliced(...t)},unshift(...t){return G(this,"unshift",t)},values(){return Se(this,"values",M)}};function Se(t,e,o){const r=xe(t),n=r[e]();return r!==t&&!V(t)&&(n._next=n.next,n.next=()=>{const s=n._next();return s.value&&(s.value=o(s.value)),s}),n}const ft=Array.prototype;function k(t,e,o,r,n,s){const l=xe(t),i=l!==t&&!V(t),c=l[e];if(c!==ft[e]){const f=c.apply(t,s);return i?M(f):f}let d=o;l!==t&&(i?d=function(f,x){return o.call(this,M(f),x,t)}:o.length>2&&(d=function(f,x){return o.call(this,f,x,t)}));const m=c.call(l,d,r);return i&&n?n(m):m}function Pe(t,e,o,r){const n=xe(t);let s=o;return n!==t&&(V(t)?o.length>3&&(s=function(l,i,c){return o.call(this,l,i,c,t)}):s=function(l,i,c){return o.call(this,l,M(i),c,t)}),n[e](s,...r)}function ve(t,e,o){const r=T(t);L(r,"iterate",Y);const n=r[e](...o);return(n===-1||n===!1)&&_t(o[0])?(o[0]=T(o[0]),r[e](...o)):n}function G(t,e,o=[]){at(),pe();const r=T(t)[e].apply(t,o);return we(),ct(),r}const mt=tt("__proto__,__v_isRef,__isVue"),Oe=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(X));function ht(t){X(t)||(t=String(t));const e=T(this);return L(e,"has",t),e.hasOwnProperty(t)}class Ve{constructor(e=!1,o=!1){this._isReadonly=e,this._isShallow=o}get(e,o,r){if(o==="__v_skip")return e.__v_skip;const n=this._isReadonly,s=this._isShallow;if(o==="__v_isReactive")return!n;if(o==="__v_isReadonly")return n;if(o==="__v_isShallow")return s;if(o==="__v_raw")return r===(n?s?Et:We:s?Ct:Fe).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const l=U(e);if(!n){let c;if(l&&(c=dt[o]))return c;if(o==="hasOwnProperty")return ht}const i=Reflect.get(e,o,z(e)?e:r);return(X(o)?Oe.has(o):mt(o))||(n||L(e,"get",o),s)?i:z(i)?l&&he(o)?i:i.value:ne(i)?n?je(i):Ee(i):i}}class gt extends Ve{constructor(e=!1){super(!1,e)}set(e,o,r,n){let s=e[o];if(!this._isShallow){const c=Q(s);if(!V(r)&&!Q(r)&&(s=T(s),r=T(r)),!U(e)&&z(s)&&!z(r))return c?!1:(s.value=r,!0)}const l=U(e)&&he(o)?Number(o)<e.length:me(e,o),i=Reflect.set(e,o,r,z(e)?e:n);return e===T(n)&&(l?re(r,s)&&P(e,"set",o,r):P(e,"add",o,r)),i}deleteProperty(e,o){const r=me(e,o);e[o];const n=Reflect.deleteProperty(e,o);return n&&r&&P(e,"delete",o,void 0),n}has(e,o){const r=Reflect.has(e,o);return(!X(o)||!Oe.has(o))&&L(e,"has",o),r}ownKeys(e){return L(e,"iterate",U(e)?"length":O),Reflect.ownKeys(e)}}class pt extends Ve{constructor(e=!1){super(!0,e)}set(e,o){return!0}deleteProperty(e,o){return!0}}const wt=new gt,yt=new pt,Ce=t=>t,ie=t=>Reflect.getPrototypeOf(t);function bt(t,e,o){return function(...r){const n=this.__v_raw,s=T(n),l=oe(s),i=t==="entries"||t===Symbol.iterator&&l,c=t==="keys"&&l,d=n[t](...r),m=o?Ce:e?Te:M;return!e&&L(s,"iterate",c?be:O),{next(){const{value:f,done:x}=d.next();return x?{value:f,done:x}:{value:i?[m(f[0]),m(f[1])]:m(f),done:x}},[Symbol.iterator](){return this}}}}function le(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function xt(t,e){const o={get(n){const s=this.__v_raw,l=T(s),i=T(n);t||(re(n,i)&&L(l,"get",n),L(l,"get",i));const{has:c}=ie(l),d=e?Ce:t?Te:M;if(c.call(l,n))return d(s.get(n));if(c.call(l,i))return d(s.get(i));s!==l&&s.get(n)},get size(){const n=this.__v_raw;return!t&&L(T(n),"iterate",O),Reflect.get(n,"size",n)},has(n){const s=this.__v_raw,l=T(s),i=T(n);return t||(re(n,i)&&L(l,"has",n),L(l,"has",i)),n===i?s.has(n):s.has(n)||s.has(i)},forEach(n,s){const l=this,i=l.__v_raw,c=T(i),d=e?Ce:t?Te:M;return!t&&L(c,"iterate",O),i.forEach((m,f)=>n.call(s,d(m),d(f),l))}};return ot(o,t?{add:le("add"),set:le("set"),delete:le("delete"),clear:le("clear")}:{add(n){!e&&!V(n)&&!Q(n)&&(n=T(n));const s=T(this);return ie(s).has.call(s,n)||(s.add(n),P(s,"add",n,n)),this},set(n,s){!e&&!V(s)&&!Q(s)&&(s=T(s));const l=T(this),{has:i,get:c}=ie(l);let d=i.call(l,n);d||(n=T(n),d=i.call(l,n));const m=c.call(l,n);return l.set(n,s),d?re(s,m)&&P(l,"set",n,s):P(l,"add",n,s),this},delete(n){const s=T(this),{has:l,get:i}=ie(s);let c=l.call(s,n);c||(n=T(n),c=l.call(s,n)),i&&i.call(s,n);const d=s.delete(n);return c&&P(s,"delete",n,void 0),d},clear(){const n=T(this),s=n.size!==0,l=n.clear();return s&&P(n,"clear",void 0,void 0),l}}),["keys","values","entries",Symbol.iterator].forEach(n=>{o[n]=bt(n,t,e)}),o}function He(t,e){const o=xt(t,e);return(r,n,s)=>n==="__v_isReactive"?!t:n==="__v_isReadonly"?t:n==="__v_raw"?r:Reflect.get(me(o,n)&&n in r?o:r,n,s)}const St={get:He(!1,!1)},vt={get:He(!0,!1)},Fe=new WeakMap,Ct=new WeakMap,We=new WeakMap,Et=new WeakMap;function Tt(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function It(t){return t.__v_skip||!Object.isExtensible(t)?0:Tt(it(t))}function Ee(t){return Q(t)?t:Ue(t,!1,wt,St,Fe)}function je(t){return Ue(t,!0,yt,vt,We)}function Ue(t,e,o,r,n){if(!ne(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const s=It(t);if(s===0)return t;const l=n.get(t);if(l)return l;const i=new Proxy(t,s===2?r:o);return n.set(t,i),i}function Q(t){return!!(t&&t.__v_isReadonly)}function V(t){return!!(t&&t.__v_isShallow)}function _t(t){return t?!!t.__v_raw:!1}function T(t){const e=t&&t.__v_raw;return e?T(e):t}const M=t=>ne(t)?Ee(t):t,Te=t=>ne(t)?je(t):t;function z(t){return t?t.__v_isRef===!0:!1}/*!
 * pinia v3.0.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */var Ke;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(Ke||(Ke={}));const Ie=()=>({feishu:{label:"飞书多维表格设置",feishu_base_url:{value:"",max:200,defalutVaue:"",label:"多维表格URL",placeholder:"多维表格URL 例如: https://mideqnf1p7d.feishu.cn/base/TAAsbKNniaMaodss84tcEQSun3f?table=tbllpvh8BykaNQBM&view=vewvd05oOX"}},dignding:{label:"钉钉AI表格设置",appKey:{value:"",max:100,defalutVaue:"",label:"appKey",placeholder:"appKey"},appSecret:{value:"",max:100,defalutVaue:"",label:"appSecret",placeholder:"appSecret"},baseId:{value:"",max:100,defalutVaue:"",label:"baseId",placeholder:"baseId 文档Id"},phone:{value:"",max:100,defalutVaue:"",label:"手机号",placeholder:"钉钉用户绑定的手机号码"}},douyin:{label:"抖音设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxUserVideoCount:{value:100,max:200,defalutVaue:100,label:"最大用户视频数量",placeholder:"最大用户视频数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},xiaohongshu:{label:"小红书设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxUserNoteCount:{value:100,max:200,defalutVaue:100,label:"最大用户笔记数量",placeholder:"最大用户笔记数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},jd:{label:"京东设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},taobao:{label:"淘宝设置",maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},sycm_taobao:{label:"生意参谋设置",maxOverviewDataCount:{value:100,max:200,defalutVaue:100,label:"最大客户概况数量",placeholder:"最大客户概况数量"},maxCustomerTripDataCount:{value:100,max:200,defalutVaue:100,label:"最大客户旅程数量",placeholder:"最大客户旅程数量"},maxCustomerTripGoodsDataCount:{value:100,max:200,defalutVaue:100,label:"最大客户旅程商品数量",placeholder:"最大客户旅程商品数量"}},one_alimama:{label:"阿里妈妈万象台设置",maxGoodsListCount:{value:100,max:200,defalutVaue:100,label:"最大商品数量",placeholder:"最大商品数量"}},tiktok:{label:"tiktok设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxUserVideoCount:{value:100,max:200,defalutVaue:100,label:"最大用户视频数量",placeholder:"最大用户视频数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},youtube:{label:"tiktok设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxUserVideoCount:{value:100,max:200,defalutVaue:100,label:"最大用户视频数量",placeholder:"最大用户视频数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}}});let qt=Ie();Ee(qt);const Be="__setting",_e=async()=>{var e=(await A.storage.local.get([Be]))[Be];if(e){const r=e;var o=Ie();return Object.keys(o).forEach(n=>{n in r||(r[n]=o[n])}),r}else return Ie()};async function At(t=!1){console.log("开始抓取小红书搜索数据");const o=(await _e()).xiaohongshu.maxSearchListCount.value;return{searchList:await new Promise(async(s,l)=>{try{let i=function(I,_){Xe(`已找到 ${I}/${_} 个笔记，继续加载中...`)},c=function(){const I=document.querySelectorAll(".note-item");console.log(`当前页面找到 ${I.length} 个笔记元素`);let _=0;for(const a of I)try{const w=a.querySelector("a.cover")||a.querySelector('a[href*="/explore/note/"]');if(!w){console.warn("找不到链接元素，跳过此笔记");continue}const g=w.href;if(m.has(g))continue;m.add(g),_++;const v=a.querySelector("img[data-xhs-img]")||a.querySelector("img.cover"),u=v?v.src:"",h=a.querySelector(".title span")||a.querySelector(".content"),C=h?h.textContent.trim():"",y=a.querySelector(".author")||a.querySelector(".user-name"),E=y?y.textContent.trim():"",$=a.querySelector(".author a")||a.querySelector(".user-name a")||y,H=$&&$.href?$.href:"",F=a.querySelector(".author img")||a.querySelector(".avatar img"),B=F?F.src:"",W=a.querySelector(".like-wrapper .count")||a.querySelector(".like-count"),J=W?W.textContent.trim():"0";if(f.push({title:C,cover:u,author:E,authorID:"",authorLink:H,authorAvatar:B,link:g,likes:J,isTop:!1,duration:"",publishTime:""}),f.length>=x)break}catch(w){console.error("抓取单个笔记时出错:",w)}return console.log(`本次新增 ${_} 个笔记，当前总数: ${f.length}`),_};Xe("正在查找笔记元素...");let d=!1;const m=new Set,f=[],x=o,q=15;let R=0,p=0;async function S(){if(!d){d=!0;try{const I=c();if(i(f.length,x),f.length>=x){console.log(`已达到目标数量 ${x} 个笔记，停止滚动`),d=!1,s(f);return}if(I===0){if(p++,console.log(`本次滚动没有新增笔记，无新数据计数: ${p}`),p>=3){console.log(`连续 ${p} 次没有新增笔记，可能已加载完全部内容`),d=!1,s(f);return}}else p=0;if(R++,R>=q){console.log(`已达到最大重试次数 ${q}，停止滚动`),d=!1,s(f);return}console.log(`滚动加载更多内容，当前已有 ${f.length} 个笔记`),window.scrollTo(0,document.body.scrollHeight),await new Promise(_=>setTimeout(_,2e3)),d=!1,await S()}catch(I){console.error("滚动加载时出错:",I),d=!1,f.length>0?(console.log(`虽然出错，但已抓取到 ${f.length} 个笔记，返回现有数据`),s(f)):l(I)}}}S()}catch(i){console.error("抓取小红书搜索数据时出错:",i),l(i)}})}}function Xe(t){try{N.sendMessage(t)}catch(e){console.error("发送状态更新失败:",e)}}async function Rt(t=!1){console.log("开始抓取小红书用户页面数据");const o=(await _e()).xiaohongshu.maxUserNoteCount.value;return new Promise(async(r,n)=>{try{let s=function(u,h){ae(`已找到 ${u}/${h} 个笔记，继续加载中...`)},l=function(){const u=document.querySelector("#userPostedFeeds")||document.querySelector(".feeds-container");if(!u)return console.error("找不到笔记容器"),0;const h=u.querySelectorAll(".note-item");console.log(`当前页面找到 ${h.length} 个笔记元素`);let C=0;for(const y of h)try{const E=y.querySelector("a.cover")||y.querySelector('a[href*="/explore/note/"]')||y.querySelector('a[href*="/user/profile/"]');if(!E){console.warn("找不到链接元素，跳过此笔记");continue}const $=E.href;if(I.has($))continue;I.add($),C++;const H=y.querySelector("img[data-xhs-img]")||y.querySelector("img.cover")||E.querySelector("img"),F=H?H.src:"",B=y.querySelector(".title span")||y.querySelector(".content")||y.querySelector(".desc"),W=B?B.textContent.trim():"",J=i.username,Le=!!(y.querySelector(".top-tag-area .top-wrapper")||y.querySelector(".top-wrapper")),Me=y.querySelector(".like-wrapper .count")||y.querySelector(".like-count")||y.querySelector(".interact-info"),ee=Me?Me.textContent.trim():"0";if(i.notes.push({title:W,cover:F,author:J,authorID:"",authorLink:window.location.href,authorAvatar:i.avatar,link:$,likes:ee,isTop:Le,duration:"",publishTime:""}),i.notes.length>=_)break}catch(E){console.error("抓取单个笔记时出错:",E)}return console.log(`本次新增 ${C} 个笔记，当前总数: ${i.notes.length}`),C};ae("正在获取用户信息...");const i={userId:"",username:"",avatar:"",description:"",age:"",gender:"",constellation:"",location:"",ipLocation:"",following:"",followers:"",likes:"",postCount:"",verified:"",notes:[]},c=document.querySelector(".user-info");if(!c){console.error("找不到用户信息容器"),ae("无法获取用户信息"),n(new Error("找不到用户信息容器"));return}const d=c.querySelector(".user-name");d&&(i.username=d.textContent.trim(),console.log(`找到用户昵称: ${i.username}`));const m=c.querySelector(".user-redId");m&&(i.userId=m.textContent.replace("小红书号：","").trim(),console.log(`找到用户ID: ${i.userId}`));const f=c.querySelector(".avatar-wrapper img");f&&(i.avatar=f.src,console.log(`找到用户头像: ${i.avatar}`));const x=c.querySelector(".user-desc");x&&(i.description=x.textContent.trim(),console.log(`找到用户简介: ${i.description}`));const q=c.querySelectorAll(".tag-item");if(q.length>0){for(const u of q){const h=u.querySelector(".gender");if(h){const C=h.querySelector("use");if(C){const E=C.getAttribute("xlink:href");E==="#male"?i.gender="男":E==="#female"&&(i.gender="女")}const y=h.querySelector(".gender-text");if(y){const E=y.textContent.trim();E.includes("岁")?(i.age=E,console.log(`找到用户年龄: ${i.age}`)):E.includes("座")&&(i.constellation=E,console.log(`找到用户星座: ${i.constellation}`))}}}q.length>1&&!q[1].querySelector(".gender")&&(i.location=q[1].textContent.trim(),console.log(`找到用户地区: ${i.location}`))}const R=c.querySelector(".user-IP");R&&(i.ipLocation=R.textContent.replace("IP属地：","").trim(),console.log(`找到IP属地: ${i.ipLocation}`));const p=c.querySelectorAll(".user-interactions > div");if(p.length>=3){const u=p[0].querySelector(".count");u&&(i.following=u.textContent.trim(),console.log(`找到关注数: ${i.following}`));const h=p[1].querySelector(".count");h&&(i.followers=h.textContent.trim(),console.log(`找到粉丝数: ${i.followers}`));const C=p[2].querySelector(".count");C&&(i.likes=C.textContent.trim(),console.log(`找到获赞数: ${i.likes}`))}ae(`正在抓取用户 ${i.username} 的笔记...`);let S=!1;const I=new Set,_=o,a=15;let w=0,g=0;async function v(){if(!S){S=!0;try{const u=l();if(s(i.notes.length,_),i.notes.length>=_){console.log(`已达到目标数量 ${_} 个笔记，停止滚动`),S=!1,r(i);return}if(u===0){if(g++,console.log(`本次滚动没有新增笔记，无新数据计数: ${g}`),g>=3){console.log(`连续 ${g} 次没有新增笔记，可能已加载完全部内容`),S=!1,r(i);return}}else g=0;if(w++,w>=a){console.log(`已达到最大重试次数 ${a}，停止滚动`),S=!1,r(i);return}console.log(`滚动加载更多内容，当前已有 ${i.notes.length} 个笔记`),window.scrollTo(0,document.body.scrollHeight),await new Promise(h=>setTimeout(h,2e3)),S=!1,v()}catch(u){console.error("滚动加载时出错:",u),S=!1,r(i)}}}await v()}catch(s){console.error("抓取小红书用户页面数据时出错:",s),n(s)}})}function ae(t){try{N.sendMessage(t)}catch(e){console.error("发送状态更新失败:",e)}}async function Lt(){console.log("开始抓取小红书笔记详情数据..."),console.log("当前URL:",window.location.href);const e=(await _e()).xiaohongshu.maxCommentsCount.value;let o="";const r=window.location.href.match(/\/explore\/([a-zA-Z0-9]+)/);if(r&&r[1])o=r[1],console.log("从URL提取笔记ID:",o);else return console.error("URL中未找到笔记ID"),{error:!0,message:"URL中未找到笔记ID",title:"无法获取笔记数据",description:"请确认当前URL包含笔记ID",link:window.location.href};let n=null;try{n=await $e("#noteContainer",5e3),console.log("成功找到笔记容器元素")}catch(u){return console.error("等待笔记容器加载超时:",u),{error:!0,message:"等待笔记容器加载超时",id:o,title:"无法获取笔记数据",description:"笔记详情容器未加载",link:window.location.href}}let s="";const l=n.querySelector(".title, #detail-title");l?(s=l.textContent.trim(),console.log("提取到笔记标题:",s)):console.log("未找到笔记标题元素");let i="";const c=n.querySelector(".desc, #detail-desc");c?(i=c.textContent.trim(),console.log("提取到笔记内容:",i)):console.log("未找到笔记内容元素");let d=[];const m=n.querySelectorAll('a.tag, a[id="hash-tag"]');m&&m.length>0?(m.forEach(u=>{const h=u.textContent.trim();h&&!d.includes(h)&&d.push(h)}),console.log("提取到标签:",d)):console.log("未找到标签元素");let f={id:"",nickname:"",avatar:"",link:""};const x=n.querySelector(".author-wrapper, .author");if(x){const u=x.querySelector(".name, .username");if(u){f.nickname=u.textContent.trim(),console.log("提取到作者昵称:",f.nickname);const C=u.closest("a");if(C&&C.href){const y=C.href.match(/\/user\/profile\/([a-zA-Z0-9]+)/);y&&y[1]&&(f.id=y[1],console.log("提取到作者ID:",f.id))}}const h=x.querySelector("img.avatar-item");h&&h.src&&(f.avatar=h.src,console.log("提取到作者头像:",f.avatar))}else console.log("未找到作者信息容器");let q="";const R=n.querySelector(".date, .note-content .date");R?(q=R.textContent.trim(),console.log("提取到创建时间:",q)):console.log("未找到创建时间元素");let p={likes:0,comments:0,collects:0};const S=n.querySelector(".interact-container .like-wrapper .count");if(S){const u=S.textContent.trim();u&&u!=="赞"&&(p.likes=N.parseChineseNumber(u),console.log("提取到点赞数:",p.likes))}const I=n.querySelector(".interact-container .chat-wrapper .count");if(I){const u=I.textContent.trim(),h=u.match(/(\d+)/);h&&h[1]&&(p.comments=N.parseChineseNumber(u),console.log("提取到评论数:",p.comments))}const _=n.querySelector(".interact-container .collect-wrapper .count");if(_){const u=_.textContent.trim();u&&u!=="收藏"&&(p.collects=N.parseChineseNumber(u),console.log("提取到收藏数:",p.collects))}let a=[];const w=n.querySelector(".media-container video, video.xgplayer-video");if(w){console.log("检测到视频类型的笔记");let u="";if(w.src)u=w.src,console.log("从video元素的src属性提取视频URL:",u);else{console.log("video元素没有直接的src属性，尝试其他方式获取");try{const y=n.querySelectorAll(".xgplayer, .player-container");for(const E of y)if(E.__xgplayer__&&E.__xgplayer__.src){u=E.__xgplayer__.src,console.log("从播放器实例中提取视频URL:",u);break}}catch(y){console.error("尝试从播放器实例提取视频URL时出错:",y)}}let h="";const C=n.querySelector(".xgplayer-poster, xg-poster");if(C){const y=C.getAttribute("style");if(y){const E=y.match(/url\(['"]?(.*?)['"]?\)/);E&&E[1]&&(h=E[1],console.log("提取到视频封面:",h))}}a.push({type:"video",mediaUrl:u,cover:h})}else{const u=n.querySelectorAll(".media-container img, .note-detail-img img");u&&u.length>0?(console.log("检测到图片类型的笔记，共找到",u.length,"张图片"),u.forEach((h,C)=>{h.src&&(a.push({type:"image",url:h.src,cover:""}),console.log(`提取到第${C+1}张图片:`,h.src))})):console.log("未检测到媒体内容，可能是纯文本笔记")}let g=[];try{console.log("开始提取评论数据..."),g=await Mt(e)}catch(u){console.error("提取评论数据时出错:",u)}const v={author:{id:f.id,name:f.nickname,avatar:f.avatar,link:f.link||""},post:{id:o,title:s,coverImage:"",description:i,link:window.location.href,duration:"",publishTime:q,musicInfo:"",tags:d},interactions:{likes:p.likes,comments:p.comments,favorites:p.collects,shares:0},mediaContent:a,commentsList:g.map(u=>({id:u.id,userName:u.userName,avatar:u.avatar||"",content:u.content,likes:u.likes||"0",date:u.date||"",location:u.location||"",isAuthor:u.isAuthor,authorId:u.authorId||"",replies:u.replies||"0",replyList:u.replyList?u.replyList.map(h=>({id:h.id,userName:h.userName,avatar:h.avatar||"",content:h.content,likes:h.likes||"0",date:h.date||"",location:h.location||"",isAuthor:h.isAuthor,authorId:h.authorId,replies:h.replies||"0"})):void 0}))};return console.log("笔记数据抓取完成:",v),v}async function Mt(t=100){console.log("开始抓取小红书笔记评论数据...");const e=[],o=new Set;try{const r=await $e(".comments-el",1e4);if(!r)return console.log("未找到评论容器，跳过评论抓取"),e;const n=r.querySelector(".total"),l=(n?n.textContent.trim():"").match(/共\s*(\d+)\s*条评论/),i=l?parseInt(l[1]):0;console.log(`总评论数: ${i}`);const c=Math.min(t,i);if(c===0)return console.log("没有评论，返回空数组"),e;const d=r.querySelector(".list-container"),m=document.querySelector(".note-scroller");if(!d||!m)return console.log("未找到评论列表容器或滚动容器"),e;let f=0;const x=20;for(;f<x;){const p=d.querySelectorAll(".parent-comment").length;if(console.log(`当前已加载评论数: ${p}`),document.querySelector(".end-container")){console.log("检测到底部标记，评论已全部加载");break}if(p>=c){console.log("已达到目标评论数");break}m.scrollTop=m.scrollHeight,console.log("滚动到底部"),await new Promise(I=>setTimeout(I,1e3)),f++}await new Promise(p=>setTimeout(p,1e3));const q=d.querySelectorAll(".parent-comment");console.log(`找到 ${q.length} 条评论`);const R=p=>{let S="";if(p.id&&p.id.startsWith("comment-"))S=p.id;else{const ee=p.querySelector(".comment-item");if(!ee||!ee.id)return null;S=ee.id}if(S&&o.has(S))return null;o.add(S);const I=p.querySelector(".content .note-text"),_=I?I.textContent.trim():"",a=p.querySelector(".author"),w=a?a.querySelector(".name").textContent.trim():"",g=p.querySelector(".info .date span:first-child"),v=g?g.textContent.trim():"",u=p.querySelector(".info .date .location"),h=u?u.textContent.trim():"",C=p.querySelector(".info .interactions .like .count"),y=C?C.textContent.trim()==="赞"?"0":C.textContent.trim():"0",E=p.querySelector("img.avatar-item"),$=E?E.src:"",F=(a?a.querySelector("a").href:"").match(/\/user\/profile\/([a-zA-Z0-9]+)/),B=F?F[1]:"",W=a.querySelector(".tag"),J=W?W.textContent.includes("作者"):!1,fe=p.querySelector(".info .interactions .reply .count"),Le=fe?fe.textContent.trim()==="回复"?"0":fe.textContent.trim():"0";return{id:S,userName:w,content:_,date:v,location:h,likes:y,avatar:$,authorId:B,isAuthor:J,replies:Le}};for(const p of q)try{const S=R(p);let I=30,_=0,a=1;for(;a<10;){a++;const v=p.querySelector(".reply-container .list-container"),u=p.querySelector(".reply-container>.show-more");if(!u||!v)break;await N.waitForChildListChange(()=>{u.click()},v,1e4),await N.sleep(500);const h=p.querySelectorAll(".reply-container .list-container .comment-item-sub");if(h.length>I||_==h.length)break;_=h.length}const w=p.querySelectorAll(".reply-container .list-container .comment-item-sub"),g=[];for(const v of w){const u=R(v);u&&g.push(u)}if(S&&e.push({...S,replyList:g}),e.length>=c){console.log("达到目标评论数，停止抓取");break}}catch(S){console.error("抓取单条评论时出错:",S)}return console.log(`评论抓取完成，共获取 ${e.length} 条评论`),e}catch(r){return console.error("抓取评论数据时出错:",r),e}}const $t={matches:["https://www.xiaohongshu.com/search*","https://www.xiaohongshu.com/explore*","https://www.xiaohongshu.com/user/profile/*"],main:t=>{console.log("Hello xiaohongshu content."),Je(kt)}};async function kt(t,e){let o,r="unsupported";console.log("当前域名:",t),console.log("当前URL:",e),e.includes("/search_result")||e.includes("/explore?")||e==="https://www.xiaohongshu.com/explore"?(console.log("检测到小红书笔记搜索页面，开始抓取笔记搜索数据"),o=await At(),r="search"):e.includes("/user/profile/")?(console.log("检测到小红书用户详情页面，开始抓取用户详情数据"),o=await Rt(),r="user"):e.includes("/explore/")?(console.log("检测到小红书笔记详情页面，开始抓取笔记详情数据"),o=await Lt(),r="note"):console.log("不是支持的小红书页面类型，抓取跳过");const n=new Date().toLocaleString(),s={domain:t,type:r,data:o,fetchTime:n};return console.log("抓取结果:",s),s}function ce(t,...e){}const Dt={debug:(...t)=>ce(console.debug,...t),log:(...t)=>ce(console.log,...t),warn:(...t)=>ce(console.warn,...t),error:(...t)=>ce(console.error,...t)},de=class de extends Event{constructor(e,o){super(de.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=o}};b(de,"EVENT_NAME",Ae("wxt:locationchange"));let qe=de;function Ae(t){var e;return`${(e=A==null?void 0:A.runtime)==null?void 0:e.id}:xiaohongshu:${t}`}function Nt(t){let e,o;return{run(){e==null&&(o=new URL(location.href),e=t.setInterval(()=>{let r=new URL(location.href);r.href!==o.href&&(window.dispatchEvent(new qe(r,o)),o=r)},1e3))}}}const Z=class Z{constructor(e,o){b(this,"isTopFrame",window.self===window.top);b(this,"abortController");b(this,"locationWatcher",Nt(this));b(this,"receivedMessageIds",new Set);this.contentScriptName=e,this.options=o,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return A.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,o){const r=setInterval(()=>{this.isValid&&e()},o);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(e,o){const r=setTimeout(()=>{this.isValid&&e()},o);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(e){const o=requestAnimationFrame((...r)=>{this.isValid&&e(...r)});return this.onInvalidated(()=>cancelAnimationFrame(o)),o}requestIdleCallback(e,o){const r=requestIdleCallback((...n)=>{this.signal.aborted||e(...n)},o);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(e,o,r,n){var s;o==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(s=e.addEventListener)==null||s.call(e,o.startsWith("wxt:")?Ae(o):o,r,{...n,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),Dt.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:Z.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(e){var s,l,i;const o=((s=e.data)==null?void 0:s.type)===Z.SCRIPT_STARTED_MESSAGE_TYPE,r=((l=e.data)==null?void 0:l.contentScriptName)===this.contentScriptName,n=!this.receivedMessageIds.has((i=e.data)==null?void 0:i.messageId);return o&&r&&n}listenForNewerScripts(e){let o=!0;const r=n=>{if(this.verifyScriptStartedEvent(n)){this.receivedMessageIds.add(n.data.messageId);const s=o;if(o=!1,s&&(e!=null&&e.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}};b(Z,"SCRIPT_STARTED_MESSAGE_TYPE",Ae("wxt:content-script-started"));let Re=Z;function Ht(){}function ue(t,...e){}const Pt={debug:(...t)=>ue(console.debug,...t),log:(...t)=>ue(console.log,...t),warn:(...t)=>ue(console.warn,...t),error:(...t)=>ue(console.error,...t)};return(async()=>{try{const{main:t,...e}=$t,o=new Re("xiaohongshu",e);return await t(o)}catch(t){throw Pt.error('The content script "xiaohongshu" crashed on startup!',t),t}})()}();
xiaohongshu;
