var tiktok=function(){"use strict";var $t=Object.defineProperty;var Ht=(H,O,b)=>O in H?$t(H,O,{enumerable:!0,configurable:!0,writable:!0,value:b}):H[O]=b;var p=(H,O,b)=>Ht(H,typeof O!="symbol"?O+"":O,b);var Ke,Be;function H(t){return t}const b=(Be=(Ke=globalThis.browser)==null?void 0:Ke.runtime)!=null&&Be.id?globalThis.browser:globalThis.chrome,ee={"sycm.taobao":{name:"生意参谋",domain:"sycm.taobao",fullDomain:"sycm.taobao.com"},"one.alimama":{name:"阿里妈妈万象台",domain:"one.alimama",fullDomain:"one.alimama.com"},taobao:{name:"淘宝",domain:"taobao",fullDomain:"taobao.com"},tmall:{name:"天猫",domain:"tmall",fullDomain:"tmall.com"},tmallhk:{name:"天猫国际",domain:"tmallhk",fullDomain:"tmall.hk"},douyin:{name:"抖音",domain:"douyin",fullDomain:"douyin.com"},xiaohongshu:{name:"小红书",domain:"xiaohongshu",fullDomain:"xiaohongshu.com"},jd:{name:"京东",domain:"jd",fullDomain:"jd.com"},tiktok:{name:"tiktok",domain:"tiktok",fullDomain:"tiktok.com"},youtube:{name:"youtube",domain:"youtube",fullDomain:"youtube.com"},other:{name:"其他",domain:"other",fullDomain:"other"}};function Ge(t){console.log("getDomain",t),t||(t=window.location.href);for(let e in ee)if(t.includes(ee[e].fullDomain))return ee[e].domain;return ee.other.domain}function Qe(t,e="data_"){return t&&t.indexOf("https://sycm.taobao.com/cc/customer/trip")===0?t="https://sycm.taobao.com/cc/customer/trip":t&&t.indexOf("https://sycm.taobao.com/cc/customer/overview")===0?t="https://sycm.taobao.com/cc/customer/overview":t&&t.indexOf("https://one.alimama.com/index.html#!/manage/onesite")===0&&(t="https://one.alimama.com/index.html#!/manage/onesite"),e+btoa(t)}function ze(t,e=5e3){return new Promise((n,s)=>{console.log(`等待元素加载: ${t}, 超时: ${e}ms`);const o=document.querySelector(t);if(o)return n(o);const r=setTimeout(()=>{if(a){a.disconnect(),console.log(`等待元素超时: ${t}`);const i=document.querySelector(t);i?n(i):s(new Error(`等待元素超时: ${t}`))}},e),a=new MutationObserver((i,c)=>{const d=document.querySelector(t);d&&(clearTimeout(r),c.disconnect(),n(d))});a.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","data-e2e"]}),console.log("MutationObserver已启动")})}class Je{constructor(){p(this,"sleep",e=>new Promise(n=>setTimeout(n,e)));p(this,"runDelay",async(e,n)=>new Promise(s=>setTimeout(()=>{s(e())},n)));p(this,"sendMessage",e=>{b.runtime.sendMessage({action:"updateStatus",status:e})});p(this,"sendDataWithAction",(e,n)=>{b.runtime.sendMessage({action:n,data:e})});p(this,"openPopup",(e=-1)=>{b.runtime.sendMessage({action:"openPopup",windowId:e})});p(this,"openSidePanel",(e=-1)=>{b.runtime.sendMessage({action:"openSidePanel",windowId:e})});p(this,"elementHover",(e,n=!0)=>{e.dispatchEvent(new MouseEvent(n?"mouseover":"mouseout",{bubbles:!0}))});p(this,"setElementAnimation",e=>{const n="266A247A-6C68-4F89-8D11-B767B4E7A71C",s="animation_"+n.slice(0,8),o="class_"+n.slice(0,8);if(!document.head.querySelector(`style[data-id='${n}']`)){const r=document.createElement("style");r.type="text/css",r.setAttribute("data-id",n);const a=`
      @keyframes ${s}{
        to {  background-color :rgb(255, 0, 0);
              border: 1px solid blue;
              border-radius: 3px;
        }
      }
    `,i=`
      .${o} {
        animation: ${s} 0.5s ease-in-out 0s 2 alternate none;
      }
    `;r.innerHTML=a+i,document.head.appendChild(r)}return e.classList.remove(o),e.offsetHeight,e.classList.add(o),e});p(this,"waitForChildListChange",async(e,n,s=5e3)=>new Promise((o,r)=>{const a=setTimeout(()=>{i&&(i.disconnect(),console.log("等待元素更新超时: ",n,`超时时间：${s}ms`),o(!1))},s),i=new MutationObserver((c,d)=>{if(c.length>0)for(const u of c)if(u.type==="attributes")u.attributeName;else if(u.type==="childList"){clearTimeout(a),d.disconnect(),o(!0);return}else u.type});i.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0}),e&&e()}));p(this,"waitForElementTextChange",async(e,n,s=5e3)=>new Promise((o,r)=>{console.log("等待元素更新:",n,` 超时: ${s}ms`);const a=setTimeout(()=>{i&&(i.disconnect(),console.log("等待元素更新超时: ",n,`超时时间：${s}ms`),o(!1))},s),i=new MutationObserver((c,d)=>{if(c.length>0){for(const u of c)if(u.type==="attributes")u.attributeName;else if(u.type!=="childList"){if(u.type==="characterData"){clearTimeout(a),d.disconnect(),o(!0);return}}}});i.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0}),e&&e()}));p(this,"waitForElementAttrChange",async(e,n,s=5e3)=>new Promise((o,r)=>{console.log("等待元素属性更新:",n,` 超时: ${s}ms`);const a=setTimeout(()=>{i&&(i.disconnect(),console.log("等待元素属性更新超时: ",n,`超时时间：${s}ms`),o(!1))},s),i=new MutationObserver((c,d)=>{if(c.length>0)for(const u of c)if(u.type==="attributes"){u.attributeName,clearTimeout(a),d.disconnect(),o(!0);return}else u.type==="childList"||u.type});i.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0}),e&&e()}));p(this,"waitForElementListTextChange",async(e,n,s=5e3,o=!0)=>{let r=[];return new Promise((a,i)=>{n.forEach(c=>{this.waitForElementTextChange(()=>{},c,s).then(async d=>{r.push({target:c,result:d}),o?r.length===n.length&&a(r):r.length==1&&(await this.sleep(500),a(r))})}),e&&e()})});p(this,"waitForElementListAttrChange",async(e,n,s=5e3,o=!0)=>{let r=[];return new Promise((a,i)=>{n.forEach(c=>{this.waitForElementAttrChange(()=>{},c,s).then(async d=>{r.push({target:c,result:d}),o?r.length===n.length&&a(r):r.length==1&&(await this.sleep(500),a(r))})}),e&&e()})});p(this,"waitForElementRemove",async(e,n=5e3)=>new Promise((s,o)=>{const a=n/10;let i=0;const c=setInterval(()=>{if(!document.querySelector(e)){clearInterval(c),s(!0);return}i++,i<a?console.log("等待元素移除:",e,` 超时: ${n}ms`,`剩余时间：${n-i*10}ms`):(console.log("等待元素移除超时: ",e,`超时时间：${n}ms`),clearInterval(c),o(!1))},10)}));p(this,"scrollToElementTop",e=>{e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})});p(this,"scrollToElement",e=>{e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})});p(this,"scrollToElementBottom",e=>{e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})});p(this,"ensureElementVisible",e=>{let n=e;for(;n&&n!==document.body;){const i=n.parentElement;if(!i)break;const c=i.scrollHeight>i.clientHeight,d=i.scrollWidth>i.clientWidth;if(c||d){const u=i.getBoundingClientRect(),f=n.getBoundingClientRect();c&&(f.top<u.top?i.scrollTop-=u.top-f.top:f.bottom>u.bottom&&(i.scrollTop+=f.bottom-u.bottom)),d&&(f.left<u.left?i.scrollLeft-=u.left-f.left:f.right>u.right&&(i.scrollLeft+=f.right-u.right))}n=i}const s=window.scrollY,o=s+window.innerHeight,r=e.offsetTop,a=r+e.offsetHeight;r<s?window.scrollTo({top:r,behavior:"smooth"}):a>o&&window.scrollTo({top:a-window.innerHeight,behavior:"smooth"})});p(this,"getTextNodeValue",(e,n=!1)=>{this.setElementAnimation(e);const s=Array.from(e.childNodes).filter(o=>o.nodeType===Node.TEXT_NODE).map(o=>o.textContent).join("");return n?+s.replace(/[^\d-.]/g,""):s});p(this,"getElementText",(e,n=!0)=>e?(n&&this.setElementAnimation(e),e.textContent):"");p(this,"getElementTextToNumber",(e,n=!0)=>{if(e){const s=this.getElementText(e,n).replace(/[^\d-.]/g,"");return s&&!isNaN(s)?+s:s}return 0});p(this,"getUserInputNumber",async(e=10,n="请输入最大数据条数，默认10条，最小1条，最大100条",s=100)=>{let o=await this.showInput(n,e,s);for(;o;){let r=0;if(!isNaN(o)&&(r=parseInt(o),r>0&&r<=s)){e=r;break}o=await this.showInput(n,e,s)}return e});p(this,"waitElementInViewportUseObserver",async(e,n=5e3)=>new Promise((s,o)=>{this.isElementInViewport(e)&&s(!0),setTimeout(()=>{s(!1),r.disconnect()},n);const r=new IntersectionObserver(a=>{a.forEach(async i=>{i.isIntersecting&&(s(!0),r.disconnect())})});if(!e)return o("元素不存在");this.scrollToElement(e),r.observe(e)}));p(this,"waitElementInViewportUseClientRect",async(e,n=!1,s=5e3)=>{new Promise(async(o,r)=>{if(!e||typeof e.getBoundingClientRect!="function")return o(!1);let a=null;const i=()=>{const f=e.getBoundingClientRect(),h=window.innerHeight||document.documentElement.clientHeight,y=window.innerWidth||document.documentElement.clientWidth;let S=!1;if(n)S=f.top>=0&&f.bottom<=h&&f.left>=0&&f.right<=y;else{const I=f.top<=h&&f.bottom>=0,T=f.left<=y&&f.right>=0;S=I&&T}S&&(a&&clearInterval(a),o(!0))},c=10,d=parseInt(s/c+"")>0?parseInt(s/c+""):1;let u=0;a=setInterval(()=>{u++,u>d?(a&&clearInterval(a),o(!1)):i()},c)})});p(this,"isElementInViewport",e=>{const n=e.getBoundingClientRect(),s=window.innerHeight||document.documentElement.clientHeight,o=window.innerWidth||document.documentElement.clientWidth;return n.top<s&&n.bottom>0&&n.left<o&&n.right>0});p(this,"getItemTextAndLog",(e,n,s,o="")=>{const r=this.querySelector(e,n);let a=this.getElementText(r);return o&&(a=(r==null?void 0:r.getAttribute(o))||""),s&&!r&&console.log(s),a});p(this,"waitForResult",async(e,n=5e3)=>{const s=Math.floor(n/100);for(let o=0;o<s;o++){if(await e())return!0;await this.sleep(100)}return!1});p(this,"getNumberText",e=>{const n=e.match(/[\.\d]+(千万)?(万亿)?[万|亿|k|K|m|M|b|B]?/);return n?n[0]:e})}deepScroll(e){return new Promise((n,s)=>{const o=[],r={element:e.element||window,duration:e.duration||500,easing:e.easing||"easeInOutQuad",scrollContainers:o,left:e.left,top:e.top,target:e.target,callback:e.callback};function a(m){const w=[];let g=m;for(;g&&g!==document.documentElement;)i(g)&&w.push(g),g=g.parentElement;return c()&&w.push(window),w}function i(m){if(m===window||!(m instanceof HTMLElement))return!0;const w=getComputedStyle(m),g=w.overflowY==="auto"||w.overflowY==="scroll",x=w.overflowX==="auto"||w.overflowX==="scroll";return g&&m.scrollHeight>m.clientHeight||x&&m.scrollWidth>m.clientWidth}function c(){return document.documentElement.scrollHeight>window.innerHeight}function d(m,w){const g=w.getBoundingClientRect();if(m instanceof Window)return{top:u(g.top-window.pageYOffset+window.outerHeight,g.height,window.innerHeight,window.outerHeight),left:u(g.left-window.pageXOffset+window.outerWidth,g.width,window.innerWidth,window.outerWidth)};const x=m.getBoundingClientRect();return{top:u(g.top-x.top+m.scrollTop,g.height,m.clientHeight,m.scrollTop),left:u(g.left-x.left+m.scrollLeft,g.width,m.clientWidth,m.scrollLeft)}}function u(m,w,g,x){const U=x,N=x+g,$=m+w;return m>=U&&$<=N?x:m<U?m:$-g}function f(m){return m instanceof Window?window.pageYOffset:m.scrollTop}function h(m){return m instanceof Window?window.pageXOffset:m.scrollLeft}function y(m,w,g){m instanceof Window?window.scrollTo(g,w):(m.scrollTop=w,m.scrollLeft=g)}if(r.target){const m=a(r.target);let w=r.target;m.forEach(g=>{const x=d(g,w);r.scrollContainers.push({element:g,startTop:f(g),targetTop:x.top,startLeft:h(g),targetLeft:x.left}),w=g})}else r.scrollContainers.push({element:r.element,startTop:f(r.element),targetTop:r.top??f(r.element),startLeft:h(r.element),targetLeft:r.left??h(r.element)});const S={linear:m=>m,easeInQuad:m=>m*m,easeOutQuad:m=>m*(2-m),easeInOutQuad:m=>m<.5?2*m*m:-1+(4-2*m)*m},I=S[r.easing]||S.easeInOutQuad;let T=0;const L=()=>{var m;n(""),r.target,(m=r.callback)==null||m.call(r)},k=m=>{T||(T=m);const w=m-T,g=Math.min(w/r.duration,1),x=I(g);r.scrollContainers.forEach(({element:U,startTop:N,targetTop:$,startLeft:J,targetLeft:ue})=>{const M=N+($-N)*x,de=J+(ue-J)*x;y(U,M,de)}),w<r.duration?requestAnimationFrame(k):L()};requestAnimationFrame(k)})}async showInput(e,n,s){return new Promise((o,r)=>{b.runtime.sendMessage({action:"showInput",placeholder:e,defaultValue:n,max:s},a=>{o(a.value)})})}simpleUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)})}formatDateTime(e,n=!1){if(typeof e=="string")e=new Date(e);else if(typeof e=="number")e=new Date(e);else if(!(e instanceof Date))return"";if(isNaN(e))return"";const s={year:e.getFullYear(),mounth:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),ms:e.getMilliseconds()},o=(a,i=2)=>(a+"").padStart(i,"0");let r=`${s.year}-${o(s.mounth)}-${o(s.day)} ${o(s.hour)}:${o(s.minute)}:${o(s.second)}`;return n&&(r+=`:${s.ms}`),r}formatDate(e){const n=this.formatDateTime(e);return n?n.split(" ")[0]:""}parseChineseNumber(e){const n={万亿:1e12,千亿:1e11,百亿:1e10,十亿:1e9,亿:1e8,千万:1e7,百万:1e6,万:1e4,千:1e3,百:100,十:10,k:1e3,K:1e3,m:1e6,M:1e6,b:1e9,B:1e9,t:1e12,T:1e12};let s="";for(const d in n)s?s+="|"+d:s+=d;const o=String(e).match(new RegExp(`^(\\d+.?\\d*)([${s})]*)`));if(!o)return 0;const r=parseFloat(o[1]),a=o[2].trim(),i=Object.keys(n).find(d=>a.startsWith(d)),c=i?n[i]:1;return a==="千万"?r*1e7:r*c}querySelector(e,n=[]){let s=null;for(const o of n){const r=o.match(/(.+):contains\(['"](.+)['"]\)/);if(r){const a=r[1],i=r[2];if(s=e.querySelector(a),s&&s.textContent.includes(i))break}else if(s=e.querySelector(o),s)break}return s}querySelectorAll(e,n=[]){for(const s of n){const o=s.match(/(.+):contains\(['"](.+)['"]\)/);if(o){const r=o[1],a=o[2],i=e.querySelectorAll(r);if(i&&i.length>0)return Array.from(i).filter(d=>d.textContent.includes(a))}else{const r=e.querySelectorAll(s);if(r.length>0)return Array.from(r)}}return[]}querySelectorWithText(e,n=[],s=""){let o=null;for(const r of n)if(o=e.querySelectorAll(r),o.length>0){for(const a of o)if(a.textContent.includes(s))return a}return null}querySelectorAllWithText(e,n=[],s=""){let o=null;for(const r of n)if(o=e.querySelectorAll(r),o.length>0)return Array.from(o).filter(a=>a.textContent.includes(s));return[]}}const l=new Je;function Ze(t){b.runtime.onMessage.addListener((e,n,s)=>{if(e.action==="getData")return console.log("收到获取数据请求"),(async()=>{try{const o=await et(t);b.runtime.sendMessage({action:"dataReceived",data:o}),s({data:o})}catch(o){console.error("抓取数据时出错:",o),b.runtime.sendMessage({action:"dataError",error:o.message})}})(),s({action:"__default"}),!0})}async function et(t){const e=window.location.href,n=Qe(e),s=Ge(e);try{const o=await t(s,e);return console.log(`抓取到${s}数据:`,o),o.type=="unsupported"&&l.sendMessage("前页面不支持数据抓取"),await b.storage.local.set({[n]:{domain:s,type:o.type,data:o.data,timestamp:new Date().getTime(),fetchTime:o.fetchTime,url:e}}),o}catch(o){throw console.error("抓取过程中发生错误:",o),o}}const D={sniffedVideoUrl:"",sniffedVideoUrls:Array(),videoSearchAttempts:0};/**
* @vue/shared v3.5.18
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function tt(t){const e=Object.create(null);for(const n of t.split(","))e[n]=1;return n=>n in e}const nt=Object.assign,ot=Object.prototype.hasOwnProperty,fe=(t,e)=>ot.call(t,e),j=Array.isArray,te=t=>Ve(t)==="[object Map]",st=t=>typeof t=="string",B=t=>typeof t=="symbol",ne=t=>t!==null&&typeof t=="object",rt=Object.prototype.toString,Ve=t=>rt.call(t),at=t=>Ve(t).slice(8,-1),he=t=>st(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,oe=(t,e)=>!Object.is(t,e);/**
* @vue/reactivity v3.5.18
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let it,Me=0,ge;function pe(){Me++}function we(){if(--Me>0)return;let t;for(;ge;){let e=ge;for(ge=void 0;e;){const n=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(s){t||(t=s)}e=n}}if(t)throw t}let se=!0;const Re=[];function lt(){Re.push(se),se=!1}function ct(){const t=Re.pop();se=t===void 0?!0:t}class ut{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){}trigger(e){this.version++,this.notify(e)}notify(e){pe();try{for(let n=this.subs;n;n=n.prevSub)n.sub.notify()&&n.sub.dep.notify()}finally{we()}}}const ve=new WeakMap,P=Symbol(""),be=Symbol(""),Y=Symbol("");function E(t,e,n){if(se&&it){let s=ve.get(t);s||ve.set(t,s=new Map);let o=s.get(n);o||(s.set(n,o=new ut),o.map=s,o.key=n),o.track()}}function q(t,e,n,s,o,r){const a=ve.get(t);if(!a)return;const i=c=>{c&&c.trigger()};if(pe(),e==="clear")a.forEach(i);else{const c=j(t),d=c&&he(n);if(c&&n==="length"){const u=Number(s);a.forEach((f,h)=>{(h==="length"||h===Y||!B(h)&&h>=u)&&i(f)})}else switch((n!==void 0||a.has(void 0))&&i(a.get(n)),d&&i(a.get(Y)),e){case"add":c?d&&i(a.get("length")):(i(a.get(P)),te(t)&&i(a.get(be)));break;case"delete":c||(i(a.get(P)),te(t)&&i(a.get(be)));break;case"set":te(t)&&i(a.get(P));break}}we()}function F(t){const e=v(t);return e===t?e:(E(e,"iterate",Y),W(t)?e:e.map(_))}function xe(t){return E(t=v(t),"iterate",Y),t}const dt={__proto__:null,[Symbol.iterator](){return ye(this,Symbol.iterator,_)},concat(...t){return F(this).concat(...t.map(e=>j(e)?F(e):e))},entries(){return ye(this,"entries",t=>(t[1]=_(t[1]),t))},every(t,e){return V(this,"every",t,e,void 0,arguments)},filter(t,e){return V(this,"filter",t,e,n=>n.map(_),arguments)},find(t,e){return V(this,"find",t,e,_,arguments)},findIndex(t,e){return V(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return V(this,"findLast",t,e,_,arguments)},findLastIndex(t,e){return V(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return V(this,"forEach",t,e,void 0,arguments)},includes(...t){return Te(this,"includes",t)},indexOf(...t){return Te(this,"indexOf",t)},join(t){return F(this).join(t)},lastIndexOf(...t){return Te(this,"lastIndexOf",t)},map(t,e){return V(this,"map",t,e,void 0,arguments)},pop(){return X(this,"pop")},push(...t){return X(this,"push",t)},reduce(t,...e){return Oe(this,"reduce",t,e)},reduceRight(t,...e){return Oe(this,"reduceRight",t,e)},shift(){return X(this,"shift")},some(t,e){return V(this,"some",t,e,void 0,arguments)},splice(...t){return X(this,"splice",t)},toReversed(){return F(this).toReversed()},toSorted(t){return F(this).toSorted(t)},toSpliced(...t){return F(this).toSpliced(...t)},unshift(...t){return X(this,"unshift",t)},values(){return ye(this,"values",_)}};function ye(t,e,n){const s=xe(t),o=s[e]();return s!==t&&!W(t)&&(o._next=o.next,o.next=()=>{const r=o._next();return r.value&&(r.value=n(r.value)),r}),o}const mt=Array.prototype;function V(t,e,n,s,o,r){const a=xe(t),i=a!==t&&!W(t),c=a[e];if(c!==mt[e]){const f=c.apply(t,r);return i?_(f):f}let d=n;a!==t&&(i?d=function(f,h){return n.call(this,_(f),h,t)}:n.length>2&&(d=function(f,h){return n.call(this,f,h,t)}));const u=c.call(a,d,s);return i&&o?o(u):u}function Oe(t,e,n,s){const o=xe(t);let r=n;return o!==t&&(W(t)?n.length>3&&(r=function(a,i,c){return n.call(this,a,i,c,t)}):r=function(a,i,c){return n.call(this,a,_(i),c,t)}),o[e](r,...s)}function Te(t,e,n){const s=v(t);E(s,"iterate",Y);const o=s[e](...n);return(o===-1||o===!1)&&_t(n[0])?(n[0]=v(n[0]),s[e](...n)):o}function X(t,e,n=[]){lt(),pe();const s=v(t)[e].apply(t,n);return we(),ct(),s}const ft=tt("__proto__,__v_isRef,__isVue"),qe=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(B));function ht(t){B(t)||(t=String(t));const e=v(this);return E(e,"has",t),e.hasOwnProperty(t)}class Pe{constructor(e=!1,n=!1){this._isReadonly=e,this._isShallow=n}get(e,n,s){if(n==="__v_skip")return e.__v_skip;const o=this._isReadonly,r=this._isShallow;if(n==="__v_isReactive")return!o;if(n==="__v_isReadonly")return o;if(n==="__v_isShallow")return r;if(n==="__v_raw")return s===(o?r?Ct:Ne:r?St:Ue).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const a=j(e);if(!o){let c;if(a&&(c=dt[n]))return c;if(n==="hasOwnProperty")return ht}const i=Reflect.get(e,n,Q(e)?e:s);return(B(n)?qe.has(n):ft(n))||(o||E(e,"get",n),r)?i:Q(i)?a&&he(n)?i:i.value:ne(i)?o?$e(i):Ce(i):i}}class gt extends Pe{constructor(e=!1){super(!1,e)}set(e,n,s,o){let r=e[n];if(!this._isShallow){const c=G(r);if(!W(s)&&!G(s)&&(r=v(r),s=v(s)),!j(e)&&Q(r)&&!Q(s))return c?!1:(r.value=s,!0)}const a=j(e)&&he(n)?Number(n)<e.length:fe(e,n),i=Reflect.set(e,n,s,Q(e)?e:o);return e===v(o)&&(a?oe(s,r)&&q(e,"set",n,s):q(e,"add",n,s)),i}deleteProperty(e,n){const s=fe(e,n);e[n];const o=Reflect.deleteProperty(e,n);return o&&s&&q(e,"delete",n,void 0),o}has(e,n){const s=Reflect.has(e,n);return(!B(n)||!qe.has(n))&&E(e,"has",n),s}ownKeys(e){return E(e,"iterate",j(e)?"length":P),Reflect.ownKeys(e)}}class pt extends Pe{constructor(e=!1){super(!0,e)}set(e,n){return!0}deleteProperty(e,n){return!0}}const wt=new gt,vt=new pt,Se=t=>t,re=t=>Reflect.getPrototypeOf(t);function bt(t,e,n){return function(...s){const o=this.__v_raw,r=v(o),a=te(r),i=t==="entries"||t===Symbol.iterator&&a,c=t==="keys"&&a,d=o[t](...s),u=n?Se:e?Ee:_;return!e&&E(r,"iterate",c?be:P),{next(){const{value:f,done:h}=d.next();return h?{value:f,done:h}:{value:i?[u(f[0]),u(f[1])]:u(f),done:h}},[Symbol.iterator](){return this}}}}function ae(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function xt(t,e){const n={get(o){const r=this.__v_raw,a=v(r),i=v(o);t||(oe(o,i)&&E(a,"get",o),E(a,"get",i));const{has:c}=re(a),d=e?Se:t?Ee:_;if(c.call(a,o))return d(r.get(o));if(c.call(a,i))return d(r.get(i));r!==a&&r.get(o)},get size(){const o=this.__v_raw;return!t&&E(v(o),"iterate",P),Reflect.get(o,"size",o)},has(o){const r=this.__v_raw,a=v(r),i=v(o);return t||(oe(o,i)&&E(a,"has",o),E(a,"has",i)),o===i?r.has(o):r.has(o)||r.has(i)},forEach(o,r){const a=this,i=a.__v_raw,c=v(i),d=e?Se:t?Ee:_;return!t&&E(c,"iterate",P),i.forEach((u,f)=>o.call(r,d(u),d(f),a))}};return nt(n,t?{add:ae("add"),set:ae("set"),delete:ae("delete"),clear:ae("clear")}:{add(o){!e&&!W(o)&&!G(o)&&(o=v(o));const r=v(this);return re(r).has.call(r,o)||(r.add(o),q(r,"add",o,o)),this},set(o,r){!e&&!W(r)&&!G(r)&&(r=v(r));const a=v(this),{has:i,get:c}=re(a);let d=i.call(a,o);d||(o=v(o),d=i.call(a,o));const u=c.call(a,o);return a.set(o,r),d?oe(r,u)&&q(a,"set",o,r):q(a,"add",o,r),this},delete(o){const r=v(this),{has:a,get:i}=re(r);let c=a.call(r,o);c||(o=v(o),c=a.call(r,o)),i&&i.call(r,o);const d=r.delete(o);return c&&q(r,"delete",o,void 0),d},clear(){const o=v(this),r=o.size!==0,a=o.clear();return r&&q(o,"clear",void 0,void 0),a}}),["keys","values","entries",Symbol.iterator].forEach(o=>{n[o]=bt(o,t,e)}),n}function We(t,e){const n=xt(t,e);return(s,o,r)=>o==="__v_isReactive"?!t:o==="__v_isReadonly"?t:o==="__v_raw"?s:Reflect.get(fe(n,o)&&o in s?n:s,o,r)}const yt={get:We(!1,!1)},Tt={get:We(!0,!1)},Ue=new WeakMap,St=new WeakMap,Ne=new WeakMap,Ct=new WeakMap;function Et(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function It(t){return t.__v_skip||!Object.isExtensible(t)?0:Et(at(t))}function Ce(t){return G(t)?t:He(t,!1,wt,yt,Ue)}function $e(t){return He(t,!0,vt,Tt,Ne)}function He(t,e,n,s,o){if(!ne(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const r=It(t);if(r===0)return t;const a=o.get(t);if(a)return a;const i=new Proxy(t,r===2?s:n);return o.set(t,i),i}function G(t){return!!(t&&t.__v_isReadonly)}function W(t){return!!(t&&t.__v_isShallow)}function _t(t){return t?!!t.__v_raw:!1}function v(t){const e=t&&t.__v_raw;return e?v(e):t}const _=t=>ne(t)?Ce(t):t,Ee=t=>ne(t)?$e(t):t;function Q(t){return t?t.__v_isRef===!0:!1}/*!
 * pinia v3.0.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */var je;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(je||(je={}));const Ie=()=>({feishu:{label:"飞书多维表格设置",feishu_base_url:{value:"",max:200,defalutVaue:"",label:"多维表格URL",placeholder:"多维表格URL 例如: https://mideqnf1p7d.feishu.cn/base/TAAsbKNniaMaodss84tcEQSun3f?table=tbllpvh8BykaNQBM&view=vewvd05oOX"}},dignding:{label:"钉钉AI表格设置",appKey:{value:"",max:100,defalutVaue:"",label:"appKey",placeholder:"appKey"},appSecret:{value:"",max:100,defalutVaue:"",label:"appSecret",placeholder:"appSecret"},baseId:{value:"",max:100,defalutVaue:"",label:"baseId",placeholder:"baseId 文档Id"},phone:{value:"",max:100,defalutVaue:"",label:"手机号",placeholder:"钉钉用户绑定的手机号码"}},douyin:{label:"抖音设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxUserVideoCount:{value:100,max:200,defalutVaue:100,label:"最大用户视频数量",placeholder:"最大用户视频数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},xiaohongshu:{label:"小红书设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxUserNoteCount:{value:100,max:200,defalutVaue:100,label:"最大用户笔记数量",placeholder:"最大用户笔记数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},jd:{label:"京东设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},taobao:{label:"淘宝设置",maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},sycm_taobao:{label:"生意参谋设置",maxOverviewDataCount:{value:100,max:200,defalutVaue:100,label:"最大客户概况数量",placeholder:"最大客户概况数量"},maxCustomerTripDataCount:{value:100,max:200,defalutVaue:100,label:"最大客户旅程数量",placeholder:"最大客户旅程数量"},maxCustomerTripGoodsDataCount:{value:100,max:200,defalutVaue:100,label:"最大客户旅程商品数量",placeholder:"最大客户旅程商品数量"}},one_alimama:{label:"阿里妈妈万象台设置",maxGoodsListCount:{value:100,max:200,defalutVaue:100,label:"最大商品数量",placeholder:"最大商品数量"}},tiktok:{label:"tiktok设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxUserVideoCount:{value:100,max:200,defalutVaue:100,label:"最大用户视频数量",placeholder:"最大用户视频数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}},youtube:{label:"tiktok设置",maxSearchListCount:{value:100,max:200,defalutVaue:100,label:"搜索列表数量",placeholder:"搜索列表数量"},maxUserVideoCount:{value:100,max:200,defalutVaue:100,label:"最大用户视频数量",placeholder:"最大用户视频数量"},maxCommentsCount:{value:100,max:200,defalutVaue:100,label:"最大评论数量",placeholder:"最大评论数量"}}});let Dt=Ie();Ce(Dt);const Fe="__setting",_e=async()=>{var e=(await b.storage.local.get([Fe]))[Fe];if(e){const s=e;var n=Ie();return Object.keys(n).forEach(o=>{o in s||(s[o]=n[o])}),s}else return Ie()};async function Lt(){console.log("开始抓取tiktok视频详情..."),console.log("当前URL:",window.location.href);var t="tiktok";const n=(await _e())[t].maxCommentsCount.value;D.sniffedVideoUrl="",D.sniffedVideoUrls?console.log("已有嗅探视频URL列表，共",D.sniffedVideoUrls.length,"个"):D.sniffedVideoUrls=[],D.videoSearchAttempts=0;let s=!1,o="";const r=window.location.href.match(/\@([.\w]*)\/video\/(\d+)/);r&&r[2]&&(o=r[2],console.log("从URL提取视频ID:",o));for(let C=0;C<3;C++){let A=Array.from(document.querySelectorAll("video"));A.length==2?A=[A[0]]:A.length>2&&(A=[A[1]]);for(const R of A)await l.sleep(500),R.src&&R.src.startsWith("https:")&&(D.sniffedVideoUrl=R.src,console.log("在视频元素中找到视频URL:",D.sniffedVideoUrl)),R.querySelectorAll("source").forEach(me=>{me.src&&(console.log("发现视频source标签src:",me.src),me.src.startsWith("https:")&&(D.sniffedVideoUrl=me.src,console.log("在source标签中找到视频URL:",D.sniffedVideoUrl)))});if(D.sniffedVideoUrl){console.log("成功找到视频URL，中止进一步搜索");break}C<2&&(console.log("未找到视频URL，等待500ms后再次尝试"),await new Promise(R=>setTimeout(R,500)))}D.sniffedVideoUrl||console.log("没有立即找到视频URL，将在后台继续嗅探"),console.log('通过div[role="dialog"]属性查找当前视频元素...');let a=l.querySelector(document,['div[role="dialog"][class*="DivBrowserModeContainer"]']);if(!a){let C=l.querySelectorAll(document,["#column-list-container>article",'[class*="DivColumnListContainer"]>article']);for(let A=0;A<C.length;A++){let R=C[A];if(l.isElementInViewport(R)){a=R;break}}}if(!a)return console.error("未找到视频modal容器"),console.log("当前页面结构:"),console.log(document.body.innerHTML.substring(0,500)+"..."),l.runDelay(()=>{l.sendMessage("未找到视频详情容器，当前页面不支持抓取视频详情")},1e3),null;console.log("Modal container HTML (前300字符):"),console.log(a.innerHTML.substring(0,300)+"...");let i="";const c=l.querySelector(a,["span picture img"]);c&&c.src?i=c.src:console.log("未找到封面图元素");let d="";const u=['[data-e2e="browse-video-desc"]>span[data-e2e="new-desc-span"]','[data-e2e="browse-video-desc"]>span','[data-e2e="browse-video-desc"]>[data-e2e="new-desc-span"]','span[data-e2e="new-desc-span"]','[data-e2e="new-desc-span"]','[data-e2e="video-desc"] span'],f=await l.querySelector(a,u);d=l.getElementText(f),f??console.log("无法从标题中提取完整title");let h="",y=r[1],S="http://tiktok.com/@"+y,I="";const T=l.querySelector(a,['[data-e2e="browser-nickname"] span:first-child']);h=l.getElementText(T),h||(h=y),h??console.log("未找到作者信息");const L=l.querySelector(a,['[data-e2e="browse-user-avatar"] img','[class*="DivAvatarWrapper"] img','[class*="SpanAvatarContainer"] img']);L?I=L.src||"":console.log("未找到用户头像");const k=l.querySelector(a,['[data-e2e="browser-nickname"] span:last-child','[class*="DivCreatorInfoContainer"] span']);let m=l.getElementText(k).replace("·","").trim();k??console.log("未找到发布时间");let w="",g="",x="",U="";const N=l.querySelector(a,['[data-e2e="browse-like-count"]','[data-e2e="like-count"]']);w=l.getElementText(N),N??console.log("未找到点赞数");const $=l.querySelector(a,['[data-e2e="browse-comment-count"]','[data-e2e="comment-count"]']);g=l.getElementText($),$??console.log("未找到评论数");const J=l.querySelector(a,['[aria-haspopup="dialog"] strong','[data-e2e="search-comment-container"] div>button>strong[data-e2e="undefined-count"]','[class*="SectionActionBarContainer"]>div:nth-child(4) strong']);x=l.getElementText(J),J??console.log("未找到收藏数");const ue=l.querySelector(a,['[data-e2e="browse-share-count"]','[data-e2e="share-count"]']);U=l.getElementText(ue),ue??console.log("未找到分享数");let M="";const de=l.querySelector(a,['[class*="DivSeekBarTimeContainer"]','[class*="DivVideoControlContainer"]>div:last-child','[class*="DivVideoProgressContainer "]>p','[class*="StyledTimeDisplayText"]']);M=l.getElementText(de),M&&M.trim()&&M.indexOf("/")>-1&&(M=M.split("/")[1]),de??console.log("未找到视频时长");let ke="";const Ye=l.querySelectorAll(a,['[data-e2e="browse-video-desc"] a','a[data-e2e="search-common-link"][aria-label*="category"]','[data-e2e="video-desc"] a']);ke=Ye.map(C=>l.getElementText(C)).join(","),Ye.length>0?console.log("提取到标签:",ke):console.log("未找到标签");let K="";const Z=l.querySelector(a,['[data-e2e="browse-music"]>a','a[data-e2e="video-music"]']);K=l.getElementText(Z),K=(Z==null?void 0:Z.href)||"",K.startsWith("/")&&(K="https://www.tiktok.com"+K),Z??console.log("未找到音乐信息");const Xe=l.parseChineseNumber(g),Nt=await At(Xe>n?n:Xe,s);return{author:{id:y,name:h,avatar:I,link:S},post:{id:o,title:d,coverImage:i,description:d,link:`https://www.tiktok.com/@${y}/video/${o}`,duration:M,publishTime:m,musicInfo:K,tags:ke},interactions:{likes:w,comments:g,favorites:x,shares:U},mediaContent:[{type:"video",mediaUrl:D.sniffedVideoUrl,cover:""}],commentsList:Nt.map(C=>({userName:C.userName||"",avatar:C.avatar||"",content:C.content||"",likes:C.likes||"0",date:C.date||"",location:C.location||"",isAuthor:C.isAuthor||!1}))}}async function At(t=100,e=!1){if(t<=0)return[];console.log(`开始抓取视频评论，最多 ${t} 条`);const n=['[data-e2e="search-comment-container"]>div[class*="DivCommentListContainer"]','[class*="DivCommentListContainer"]'],s=l.querySelector(document,['[class*="DivTabMenuContainer"]>div:first-child>div','#comments [class*="DivCommentHeaderTextWrapper"]','[class*="DivCommentHeaderTextWrapper"]']);if(s&&(s.click(),!ze(n.join(","),5e3)))return console.error("未找到评论容器 "+n.join(",")),l.runDelay(()=>{l.sendMessage("未找到评论容器 "+n.join(","))},1e3),[];await l.sleep(2e3);let o=l.querySelector(document,[...n]);if(!o){if(console.error('未找到评论容器 [data-e2e="search-comment-container"]>div[class*="DivCommentListContainer"]'),o=document.getElementById("merge-all-comment-container"),!o)return console.error("备用容器也未找到，无法抓取评论"),[];console.log("使用备用评论容器进行抓取")}const r=()=>l.querySelectorAll(o,['div[class*="DivCommentItemContainer"]','[class*="DivCommentItemWrapper"]','[class*="DivCommentObjectWrapper"]']);for(;(await r()).length<=0;)l.sleep(500),l.sendMessage("为获取到评论,等待500ms...");l.sendMessage("获取到评论 开始抓取评论数据..."),console.log("找到评论容器，开始处理评论");let a=t;const i=[];l.sendMessage(`准备抓取评论，总评论数: ${a}`);async function c(){let u=r();for(;u.length>0&&u.length<a;){var f=await l.waitForChildListChange(()=>{l.scrollToElementTop(u[u.length-1])},o,5e3);if(f)u=r();else break}}async function d(){const u=r();console.log(`当前找到 ${u.length} 条评论元素`);for(const f of u){if(i.length>=t)break;try{l.scrollToElementTop(f),await l.waitElementInViewportUseObserver(f),await l.sleep(10);const h=l.querySelector(f,['[data-e2e^="comment-username"][class*="SpanUserNameText"]','span[class*="SpanUserNameText"]','span[data-e2e^="comment-username"]','[data-e2e^="comment-username"] p','[data-e2e^="comment-username"]','[class*="DivCommentHeaderWrapper"] p','[class*="DivCommentHeaderWrapper"]']),y=l.getElementText(h);h??console.log("未找到评论用户名元素");const S=l.querySelector(f,['[data-e2e^="comment-level"][class*="PCommentText"]','p[data-e2e^="comment-level"]','p[class*="PCommentText"]','[data-e2e^="comment-level"] span','[data-e2e^="comment-level"]','[class*="DivCommentContentWrapper"]>span>span']);let I=l.getElementText(S);S??console.log("未找到评论内容元素");let T="",L="";const k=l.querySelector(f,['[data-e2e^="comment-time"]','[class*="PCommentSubContent"]>span','[class*="DivCommentSubContentSplitWrapper"] >div>span:first-child','[class*="DivCommentSubContentWrapper"] span:first-child']);T=l.getElementText(k),k??console.log("未找到日期元素"),console.log("页面没有位置元素，不查找位置元素");const m=l.querySelector(f,['[data-e2e="comment-like-count"]','[class*="DivLikeWrapper"] span:last-child','[class*="DivLikeContainer"] span','[class*="DivCommentSubContentSplitWrapper "] div:nth-child(2) span']),w=l.getElementText(m);m??console.log("未找到点赞数元素");const g=l.querySelector(f,['[data-e2e^="comment-avatar"] img','[class*="SpanAvatarContainer"] img','[class*="DivAvatarWrapper"] img','[class*="DivTriggerWrapper"] img']),x=g?g.src:"";g??console.log("未找到评论用户头像元素"),i.push({userName:y,avatar:x,content:I,likes:w,date:T,location:L,isAuthor:!1})}catch(h){console.error("处理评论元素时出错:",h)}}}return console.log("开始滚动加载评论..."),await c(),await d(),console.log(`评论抓取完成，共抓取 ${i.length}/${a} 条评论`),l.sendMessage(`已抓取 ${i.length}/${a} 条评论`),i.filter(u=>u.userName&&u.content)}async function kt(){console.log("开始抓取tiktok搜索页数据...");const e=(await _e()).tiktok.maxSearchListCount.value,n=await Vt(e);return console.log(`共抓取到 ${n==null?void 0:n.length} 个视频数据`),{searchList:n}}async function Vt(t){const e=[];var n=l.querySelector(document,['#tabs-0-panel-search_top [data-e2e="search_top-item-list"]','[data-e2e="search_top-item-list"]','#tabs-0-panel-search_video [data-e2e="search_video-item-list"]','[data-e2e="search_video-item-list"]']);if(!n)return console.log("未找到搜索结果列表容器"),[];const s=()=>l.querySelectorAll(n,['[class*="DivItemContainerForSearch"]','[id^="column-item-video-container"]']),o=async()=>{for(var a=s();a.length<t;){var i=await l.waitForChildListChange(()=>{l.scrollToElementTop(a[a.length-1])},n,5e3);if(i)a=s();else break}},r=async()=>{var a=s();a.length>0&&(l.scrollToElement(a[0]),await l.sleep(1e3));for(const i of a){if(e.length>=t)break;l.scrollToElement(i),await l.waitElementInViewportUseObserver(i,1e4);const c=l.getItemTextAndLog(i,['[class*="DivDescriptionContentContainer"] span:first-child','[data-e2e="new-desc-span"]'],"未找到标题"),d=l.getItemTextAndLog(i,['[class*="DivPlayerContainer"] img','[class*="DivPlayerContainer"] picture img'],"未找到封面","src"),u=l.getItemTextAndLog(i,['[data-e2e="search-card-user-unique-id"]'],"未找到作者"),f=l.getItemTextAndLog(i,['[data-e2e="search-card-user-unique-id"]'],"未找到作者ID");let h=l.getItemTextAndLog(i,['[data-e2e="search-card-user-link"]'],"未找到作者链接","href");h.startsWith("http")||(h=new URL(window.location.href).origin+h);const y=l.getItemTextAndLog(i,['[class*="SpanAvatarContainer"] img','[data-e2e="search-card-user-link"] img'],"未找到作者头像","src"),S=l.getItemTextAndLog(i,['[class*="VideoContainer"]'],"未找到链接","href"),I=l.getItemTextAndLog(i,['[data-e2e="video-views"]','[class*="DivCardFooter"] strong'],"未找到点赞数"),T=!1;let L="";const k=l.getItemTextAndLog(i,['[class*="DivTimeTag"]','[class*="DivPlayLine"]>div'],"未找到发布时间");e.push({title:c,cover:d,author:u,authorID:f,authorLink:h,authorAvatar:y,link:S,likes:I,isTop:T,duration:L,publishTime:k})}};return await o(),await r(),e}async function Mt(){console.log("开始抓取tiktok用户页面数据..."),console.log("提取用户基本信息...");const e=(await _e()).tiktok.maxUserVideoCount.value,n=l.querySelector(document,['[class*="DivShareLayoutHeader"]']);if(n==null)return{userId:"",username:"",avatar:"",description:"",age:"",gender:"",constellation:"",location:"",ipLocation:"",following:"",followers:"",likes:"",postCount:"",verified:"",videos:[]};let s=l.getItemTextAndLog(n,['[class*="DivAvatarWrapper"] img','[class*="SpanAvatarContainer"] img'],"未获取到用户头像","src");const o=l.getItemTextAndLog(n,['[data-e2e="user-subtitle"]'],"未获取到用户昵称");let r=l.getItemTextAndLog(n,['[class*="DivSCMText"]'],"未获取到用户认证信息"),a=l.getItemTextAndLog(n,['[data-e2e="user-title"]'],"未获取到用户ID");const i="";let c="",d="",u=l.getItemTextAndLog(n,['[data-e2e="user-bio"]'],"未获取到用户简介"),f=l.getItemTextAndLog(n,['[data-e2e="following-count"]'],"未获取到用户关注数"),h=l.getItemTextAndLog(n,['[data-e2e="followers-count"]'],"未获取到用户粉丝数"),y=l.getItemTextAndLog(n,['[data-e2e="likes-count"]'],"未获取到用户获赞数");console.log("关注数:",f),console.log("粉丝数:",h),console.log("获赞数:",y);let S="";const I=Math.min(e,e);console.log(`将抓取最多 ${I} 个视频`);const T={userId:a,username:o,avatar:s,description:u,age:d,gender:c,constellation:"",location:i,ipLocation:"",following:f,followers:h,likes:y,postCount:S,verified:r,videos:[]},L=await Rt(I,T);return console.log(`成功抓取 ${L.length} 个视频`),T.videos=L,T}async function Rt(t=100,e){const n=[];console.log(`开始抓取用户视频，最多 ${t} 个...`);var s=l.querySelector(document,['[class*="DivShareLayoutMain"]']);if(!s)return n;var o=l.querySelector(s,['[data-e2e="videos-tab"]',"p"]);if(!o)return n;o.getAttribute("aria-selected")!="true"&&l.waitForChildListChange(()=>{o.click()},s,5e3);const r=()=>{var c=l.querySelectorAll(s,['[id^="column-item-video-container"]']);return c};await l.waitForResult(()=>r().length>0,1e4);const a=async()=>{for(var c=r();c.length<t;){var d=await l.waitForChildListChange(()=>{l.scrollToElementTop(c[c.length-1])},s,5e3);if(d)c=r();else break}},i=async()=>{var c=r();c.length>0&&(l.scrollToElement(c[0]),await l.sleep(1e3));for(const d of c){if(n.length>=t)break;l.scrollToElement(d),await l.waitElementInViewportUseObserver(d);let u=l.getItemTextAndLog(d,['[class*="DivPlayerContainer "] img'],"未获取到视频标题","alt");u.indexOf("created by")>-1&&(u=u.split("created by")[0]);const f=l.getItemTextAndLog(d,['[class*="VideoContainer"]','[class*="DivWrapper"]>a'],"未获取到视频链接","href"),h=l.getItemTextAndLog(d,['[class*="DivPlayerContainer "] img'],"未获取到视频封面","src"),y=l.getItemTextAndLog(d,['[data-e2e="video-views"]',".video-count",'[class*="StrongVideoCount"]'],"未获取到点赞数");n.push({author:e.username,authorID:e.userId,authorAvatar:e.avatar,title:u,cover:h,authorLink:`https://www.tiktok.com/@${e.userId}`,link:f,likes:y,isTop:!1,duration:"",publishTime:""})}};return await a(),await i(),n}const Ot={matches:["*://*.tiktok.com/*"],main:t=>{console.log("Hello tiktok content."),Ze(qt)}};async function qt(t,e){let n,s="unsupported";console.log("当前域名:",t),console.log("当前URL:",e),e.match(/\@([.\w]*)\/video\/(\d+)/)?(console.log("检测到tiktok视频详情页面，开始抓取视频详情数据"),n=await Lt(),s="video"):e.match(/\/search(\/video)?\?q/)?(console.log("检测到tiktok视频搜索页面，开始抓取视频搜索数据"),n=await kt(),s="search"):e.match(/\@([.\w]*)$/)?(console.log("检测到tiktok用户详情页面，开始抓取用户详情数据"),n=await Mt(),s="user"):console.log("不是支持的tiktok页面类型，抓取跳过");const o=new Date().toLocaleString(),r={domain:t,type:s,data:n,fetchTime:o};return console.log("抓取结果:",r),r}function ie(t,...e){}const Pt={debug:(...t)=>ie(console.debug,...t),log:(...t)=>ie(console.log,...t),warn:(...t)=>ie(console.warn,...t),error:(...t)=>ie(console.error,...t)},ce=class ce extends Event{constructor(e,n){super(ce.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=n}};p(ce,"EVENT_NAME",Le("wxt:locationchange"));let De=ce;function Le(t){var e;return`${(e=b==null?void 0:b.runtime)==null?void 0:e.id}:tiktok:${t}`}function Wt(t){let e,n;return{run(){e==null&&(n=new URL(location.href),e=t.setInterval(()=>{let s=new URL(location.href);s.href!==n.href&&(window.dispatchEvent(new De(s,n)),n=s)},1e3))}}}const z=class z{constructor(e,n){p(this,"isTopFrame",window.self===window.top);p(this,"abortController");p(this,"locationWatcher",Wt(this));p(this,"receivedMessageIds",new Set);this.contentScriptName=e,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return b.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,n){const s=setInterval(()=>{this.isValid&&e()},n);return this.onInvalidated(()=>clearInterval(s)),s}setTimeout(e,n){const s=setTimeout(()=>{this.isValid&&e()},n);return this.onInvalidated(()=>clearTimeout(s)),s}requestAnimationFrame(e){const n=requestAnimationFrame((...s)=>{this.isValid&&e(...s)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(e,n){const s=requestIdleCallback((...o)=>{this.signal.aborted||e(...o)},n);return this.onInvalidated(()=>cancelIdleCallback(s)),s}addEventListener(e,n,s,o){var r;n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(r=e.addEventListener)==null||r.call(e,n.startsWith("wxt:")?Le(n):n,s,{...o,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),Pt.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:z.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(e){var r,a,i;const n=((r=e.data)==null?void 0:r.type)===z.SCRIPT_STARTED_MESSAGE_TYPE,s=((a=e.data)==null?void 0:a.contentScriptName)===this.contentScriptName,o=!this.receivedMessageIds.has((i=e.data)==null?void 0:i.messageId);return n&&s&&o}listenForNewerScripts(e){let n=!0;const s=o=>{if(this.verifyScriptStartedEvent(o)){this.receivedMessageIds.add(o.data.messageId);const r=n;if(n=!1,r&&(e!=null&&e.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",s),this.onInvalidated(()=>removeEventListener("message",s))}};p(z,"SCRIPT_STARTED_MESSAGE_TYPE",Le("wxt:content-script-started"));let Ae=z;function jt(){}function le(t,...e){}const Ut={debug:(...t)=>le(console.debug,...t),log:(...t)=>le(console.log,...t),warn:(...t)=>le(console.warn,...t),error:(...t)=>le(console.error,...t)};return(async()=>{try{const{main:t,...e}=Ot,n=new Ae("tiktok",e);return await t(n)}catch(t){throw Ut.error('The content script "tiktok" crashed on startup!',t),t}})()}();
tiktok;
